<?xml version='1.0' encoding='UTF-8'?>
<style xmlns="http://purl.org/net/xbiblio/csl" and="text" class="in-text" demote-non-dropping-particle="display-and-sort" page-range-format="chicago-16" version="1.0">
  <!-- This file was generated by the Style Variant Builder <https://github.com/citation-style-language/style-variant-builder>. To contribute changes, modify the template and regenerate variants. -->
  <info>
    <title>Chicago Manual of Style 17th edition (author-date)</title>
    <title-short>CMOS 17e (author-date)</title-short>
    <id>http://www.zotero.org/styles/chicago-author-date-17th-edition</id>
    <link href="http://www.zotero.org/styles/chicago-author-date-17th-edition" rel="self"/>
    <link href="http://www.zotero.org/styles/chicago-notes-bibliography" rel="template"/>
    <link href="https://www.chicagomanualofstyle.org/" rel="documentation"/>
    <author>
      <name>Andrew Dunning</name>
      <uri>https://orcid.org/0000-0003-0464-5036</uri>
    </author>
    <category citation-format="author-date"/>
    <category field="anthropology"/>
    <category field="communications"/>
    <category field="generic-base"/>
    <category field="geography"/>
    <category field="history"/>
    <category field="humanities"/>
    <category field="law"/>
    <category field="linguistics"/>
    <category field="literature"/>
    <category field="philosophy"/>
    <category field="political_science"/>
    <category field="science"/>
    <category field="social_science"/>
    <category field="sociology"/>
    <category field="theology"/>
    <summary>Chicago-style source citations (with Bluebook for legal citations), author-date system, 17th edition</summary>
    <updated>2025-07-18T02:08:56+00:00</updated>
    <rights license="http://creativecommons.org/licenses/by-sa/3.0/">This work is licensed under a Creative Commons Attribution-ShareAlike 3.0 License</rights>
  </info>
  <locale xml:lang="en">
    <terms>
      <!-- Chicago omits 'by' from `verb-short` forms; it abbreviates only the most common roles -->
      <term name="advance-online-publication">ahead of print</term>
      <term name="anonymous">unsigned</term>
      <term form="verb-short" name="collection-editor">ed.</term>
      <term form="short" name="collection-number">
        <single>vol.</single>
        <multiple>vols.</multiple>
      </term>
      <term form="verb-short" name="compiler">comp.</term>
      <term form="verb-short" name="editor">ed.</term>
      <term form="short" name="editor-translator">
        <single>ed. and trans.</single>
        <multiple>eds. and trans.</multiple>
      </term>
      <term form="short" name="editortranslator">
        <single>ed. and trans.</single>
        <multiple>eds. and trans.</multiple>
      </term>
      <term form="verb" name="editor-translator">edited and translated by</term>
      <term form="verb" name="editortranslator">edited and translated by</term>
      <term form="verb-short" name="editor-translator">ed. and trans.</term>
      <term form="verb-short" name="editortranslator">ed. and trans.</term>
      <term form="verb-short" name="illustrator">ill.</term>
      <term form="short" name="legislation">Pub. L.</term>
      <term form="short" name="line">
        <single>line</single>
        <multiple>lines</multiple>
      </term>
      <term name="manuscript">unpublished manuscript</term>
      <term form="verb" name="narrator">read by</term>
      <!-- both 'narrated by' (CMOS18 14.58) and 'read by' (CMOS18 14.164): taking the latter as it is in the section on recorded readings -->
      <term name="original-work-published">originally published as</term>
      <term form="short" name="paper-conference">paper</term>
      <term name="review-of">review of the</term>
      <term form="short" name="review-of">review of</term>
      <term name="sub-verbo">under</term>
      <term form="short" name="sub-verbo">under</term>
      <term name="timestamp">at</term>
      <term form="verb-short" name="translator">trans.</term>
    </terms>
  </locale>
  <!-- Contents:
    
       This file interprets Chicago using APA's four basic reference elements
       (cf. CMOS18 14.2, 14.64, 14.161):

        1. Author (CMOS18 13.74-86)
        2. Date (author-date system only, CMOS18 13.102)
        3. Title and descriptions (CMOS18 13.87-101)
            3.1. Title
            3.2. Description
            3.3. Identifiers (edition, contributors, volume)
        4. Source
            4.1. Serial sources
            4.2. Monographic sources
            4.3. Series
            4.4. Event
            4.5. Publisher
            4.6. Date
            4.7. Locator (including page references)
            4.8. Medium
            4.9. Archival location
            4.10. URL or persistent identifier
      
       Freeform annotations to bibliography entries: 
        
        5. Notes
       
       Chicago also provides parallel rules for legal references following
       The Bluebook: A Uniform System of Citation (code shared with APA):

        6. Legal references
            6.1. Legal author
            6.2. Legal date
            6.3. Legal title
            6.4. Legal source
  -->
  <!-- In this file, macros suffixed `-bib` and `-note` are parallel versions
       of the same features for the bibliography and notes, and all changes
       must be applied to both. They should only contain differences of
       punctuation (periods in bibliography, commas in notes) and capitalization,
       except where the comments indicate structural changes. -->
  <!-- Categories of CSL item types:

       Serial
       : article-journal article-magazine article-newspaper periodical post-weblog review review-book

       Serial or Monographic
       : interview paper-conference

         Monographic with any of `collection-editor compiler editor editorial-director`.
         A serial `paper-conference` is unpublished if it lacks any of `issue page supplement-number volume`.

       Monographic
       : article book broadcast chapter classic collection dataset document
         entry entry-dictionary entry-encyclopedia event figure
         graphic manuscript map motion_picture musical_score
         pamphlet patent performance personal_communication post report
         software song speech standard thesis webpage

       Legal
       : bill hearing legal_case legislation regulation treaty
  -->
  <!-- Variable labels -->

  <macro name="year-and-tag">
      <date variable="issued">
        <date-part name="year"/>
      </date>
  <text variable="archive_location" prefix="" suffix=". "/>
</macro>
        
<macro name="author-names">
  <names variable="author">
    <name delimiter=", " initialize-with="."/>
  </names>
</macro>

<macro name="fix-this">
  <group delimiter=" ">
    <choose>
      <if variable="chapter-number">
  <text text-case="capitalize-first" value="track"/>
</if>
      <else-if is-numeric="chapter-number">
        <label form="short" text-case="capitalize-first" variable="chapter-number"/>
      </else-if>
    </choose>
    <text text-case="capitalize-first" variable="chapter-number"/>
  </group>
</macro>

<macro name="label-collection-number">
  <group delimiter=" ">
    <choose>
      <if variable="collection-number">
        <label form="short" variable="collection-number"/>
      </if>
    </choose>
    <text variable="collection-number"/>
  </group>
</macro>

<macro name="label-edition">
  <group delimiter=" ">
    <choose>
      <if variable="edition">
        <group>
          <number form="ordinal" variable="edition"/>
          <label form="short" variable="edition"/>
        </group>
      </if>
      <else-if match="any" type="article-journal article-magazine article-newspaper periodical post-weblog review review-book">
        <group>
          <text variable="edition"/>
          <label variable="edition"/>
        </group>
      </else-if>
      <else-if match="any" type="interview paper-conference">
        <choose>
          <if variable="edition">
            <text variable="edition"/>
          </if>
          <else>
            <group>
              <text variable="edition"/>
              <label variable="edition"/>
            </group>
          </else>
        </choose>
      </else-if>
      <else>
        <text variable="edition"/>
      </else>
    </choose>
  </group>
</macro>

  <macro name="label-edition-capitalized">
  <group delimiter=" ">
    <choose>
      <if variable="edition">
        <group>
          <number form="ordinal" variable="edition"/>
          <label form="short" variable="edition"/>
        </group>
      </if>
      <else-if match="any" type="article-journal article-magazine article-newspaper periodical post-weblog review review-book">
        <group>
          <text text-case="title" variable="edition"/>
          <label text-case="capitalize-first" variable="edition"/>
        </group>
      </else-if>
      <else-if match="any" type="interview paper-conference">
        <choose>
          <if variable="edition">
            <text text-case="capitalize-first" variable="edition"/>
          </if>
          <else>
            <group>
              <text text-case="title" variable="edition"/>
              <label text-case="capitalize-first" variable="edition"/>
            </group>
          </else>
        </choose>
      </else-if>
      <else>
        <text text-case="capitalize-first" variable="edition"/>
      </else>
    </choose>
  </group>
</macro>

  <macro name="label-issue">
    <group delimiter=" ">
      <label form="short" variable="issue"/>
      <text variable="issue"/>
    </group>
  </macro>
  <macro name="label-locator">
    <group delimiter=" ">
      <choose>
        <else-if is-numeric="locator">
          <label form="short" variable="locator"/>
        </else-if>
        <else-if locator="chapter line verse" match="any"/>
        <!-- a non-numeric canonical reference is identified by its formatting and does not need a label (CMOS18 14.143-54) -->
        <else>
          <label form="short" variable="locator"/>
        </else>
      </choose>
      <text variable="locator"/>
    </group>
  </macro>
  <macro name="label-number-capitalized">
    <group delimiter=" ">
      <choose>
        <else-if is-numeric="number" match="any" type="legislation regulation">
          <label form="short" text-case="capitalize-first" variable="number"/>
        </else-if>
      </choose>
      <text text-case="capitalize-first" variable="number"/>
    </group>
  </macro>
  <macro name="label-number-of-volumes">
    <group delimiter=" ">
      <text variable="number-of-volumes"/>
      <choose>
          <label form="short" variable="number-of-volumes"/>
        </if>
      </choose>
    </group>
  </macro>
  <macro name="label-part-number">
    <group delimiter=" ">
      <choose>
          <!-- TODO: Replace with `part-number` label when CSL provides one -->
          <text form="short" term="part"/>
        </if>
      </choose>
      <text variable="part-number"/>
    </group>
  </macro>
  <macro name="label-part-number-capitalized">
    <group delimiter=" ">
      <choose>
          <!-- TODO: Replace with `part-number` label when CSL provides one -->
          <text form="short" term="part" text-case="capitalize-first"/>
        </if>
      </choose>
      <text text-case="capitalize-first" variable="part-number"/>
    </group>
  </macro>
  <macro name="label-section-capitalized">
    <group delimiter=" ">
      <choose>
          <label form="short" text-case="capitalize-first" variable="section"/>
        </if>
      </choose>
      <text text-case="title" variable="section"/>
    </group>
  </macro>
  <macro name="label-section-symbol">
    <group delimiter=" ">
      <label form="symbol" variable="section"/>
      <text variable="section"/>
    </group>
  </macro>
  <macro name="label-supplement-number">
    <group delimiter=" ">
      <choose>
        <!-- TODO: Replace with `supplement-number` label when CSL provides one -->
          <!-- if there is a volume title, it is already described as a supplement -->
          <text form="short" term="issue"/>
        </if>
        <else-if type="periodical" variable="supplement-number title">
          <text form="short" term="issue"/>
        </else-if>
        <else-if variable="supplement-number">
          <text form="short" term="supplement"/>
        </else-if>
      </choose>
      <text variable="supplement-number"/>
    </group>
  </macro>
  <macro name="label-version">
    <group delimiter=" ">
      <choose>
          <!-- short version label for software (CMOS18 14.169) -->
          <label form="short" variable="version"/>
        </if>
        <else>
          <label variable="version"/>
        </else>
      </choose>
      <text variable="version"/>
    </group>
  </macro>
  <macro name="label-version-capitalized">
    <group delimiter=" ">
      <choose>
          <!-- short version label for software (CMOS18 14.169) -->
          <label form="short" text-case="capitalize-first" variable="version"/>
        </if>
        <else>
          <label text-case="capitalize-first" variable="version"/>
        </else>
      </choose>
      <text variable="version"/>
    </group>
  </macro>
  <macro name="label-volume">
    <group delimiter=" ">
      <choose>
          <label form="short" variable="volume"/>
        </if>
      </choose>
      <text variable="volume"/>
    </group>
  </macro>
  <macro name="label-volume-capitalized">
    <group delimiter=" ">
      <choose>
          <label form="short" text-case="capitalize-first" variable="volume"/>
        </if>
      </choose>
      <text text-case="capitalize-first" variable="volume"/>
    </group>
  </macro>
  <!-- 1. Author (CMOS18 13.74-86) -->
  <macro name="author-bib">
      <name delimiter-precedes-last="always" name-as-sort-order="first"/>
      <label form="short" prefix=", "/>
      <substitute>
        <!-- cf. `interview` model (CMOS18 14.110); if it is desired to prioritize `host` over `guest`, the latter could be encoded as a `contributor` -->
        <choose>
          </if>
        </choose>
        <choose>
            <!-- contributors fall after the title of `classic` (CMOS18 14.147) -->
            <text macro="author-title-substitute-bib"/>
          </if>
          <else-if type="entry-dictionary" variable="container-title">
            <!-- contributors fall after the title of unsigned reference entries (CMOS18 14.130) -->
            <text macro="author-title-substitute-container"/>
          </else-if>
          <else-if type="entry-encyclopedia" variable="container-title">
            <text macro="author-title-substitute-container"/>
          </else-if>
        </choose>
        <choose>
          </if>
        </choose>
        <choose>
          <!-- serial `broadcast` prioritizes title (CMOS18 14.165, 14.168) -->
          <else>
            <choose>
              </if>
            </choose>
          </else>
        </choose>
        <choose>
          </if>
        </choose>
        <choose>
            <!-- `software` listed under the name of the publisher or developer (CMOS18 14.169) -->
            <text variable="publisher"/>
          </if>
          <else-if type="standard">
            <!-- `standard` listed in bibliography under organization, but note omits this (CMOS18 14.159) -->
            <text variable="authority"/>
          </else-if>
        </choose>
        <text macro="author-title-substitute-container"/>
        <text macro="author-title-substitute-bib"/>
        <choose>
            <choose>
                <text macro="source-archive-bib"/>
              </if>
            </choose>
          </if>
        </choose>
      </substitute>
    </names>
  </macro>
  <macro name="author-inline">
    <choose>
        <text macro="title-and-descriptions-short"/>
      </if>
      <else-if match="any" type="interview personal_communication">
        <text macro="author-short-and-recipient"/>
      </else-if>
      <else>
          <name form="short" initialize-with=". "/>
          <substitute>
            <choose>
              </if>
            </choose>
            <choose>
                <!-- contributors fall after the title of `classic` (CMOS18 14.147) -->
                <text macro="author-title-substitute-short"/>
              </if>
              <else-if type="entry-dictionary" variable="container-title">
                <!-- contributors fall after the title of unsigned reference entries (CMOS18 14.130) -->
                <text macro="author-title-substitute-container"/>
              </else-if>
              <else-if type="entry-encyclopedia" variable="container-title">
                <text macro="author-title-substitute-container"/>
              </else-if>
            </choose>
            <choose>
              </if>
            </choose>
            <choose>
              <else>
                <choose>
                  </if>
                </choose>
              </else>
            </choose>
            <choose>
              </if>
            </choose>
            <choose>
                <!-- `software` listed under the name of the publisher or developer (CMOS18 14.169) -->
                <text variable="publisher"/>
              </if>
              <else-if type="standard">
                <!-- `standard` listed in bibliography under organization, but note omits this (CMOS18 14.159) -->
                <text variable="authority"/>
              </else-if>
            </choose>
            <text macro="author-title-substitute-container-short"/>
            <text macro="author-title-substitute-short"/>
            <choose>
                <choose>
                    <text macro="source-archive-note"/>
                  </if>
                </choose>
              </if>
            </choose>
          </substitute>
        </names>
      </else>
    </choose>
  </macro>
  <macro name="author-sort">
    <choose>
        <text macro="legal-title"/>
      </if>
      <else>
        <text macro="author-bib"/>
      </else>
    </choose>
  </macro>
  <!-- Author elements -->
  <macro name="author-short-and-recipient">
    <group delimiter=" ">
      <choose>
        <!-- Inaccessible personal commmunication is cited in-text (CMOS18 14.111) -->
          <!-- These variables indicate whether the letter is retrievable by the reader -->
          <group delimiter=", ">
              <substitute>
                <text macro="title-and-descriptions-short"/>
              </substitute>
            </names>
          </group>
          <choose>
                <label form="verb" suffix=" "/>
                <name/>
              </names>
            </if>
          </choose>
        </if>
        <else-if variable="author recipient">
            <label/>
            <name form="short"/>
          </names>
          <choose>
                <label form="verb" suffix=" "/>
                <name form="short"/>
              </names>
            </if>
          </choose>
        </else-if>
        <else>
            <name form="short"/>
            <substitute>
              <text macro="title-and-descriptions-short"/>
            </substitute>
          </names>
        </else>
      </choose>
    </group>
  </macro>
  <macro name="author-title-substitute-bib">
    <choose>
        <!-- If a review has no `reviewed-genre` or `reviewed-title`, assume that `title` contains the title of the reviewed work; the description provides it. -->
        <choose>
            <text macro="title-bib"/>
          </if>
          <else-if variable="reviewed-genre reviewed-title title">
            <text macro="title-bib"/>
          </else-if>
          <else>
            <text macro="title-and-descriptions-bib"/>
          </else>
        </choose>
      </if>
      <else-if variable="title">
        <text macro="title-bib"/>
      </else-if>
      <else>
        <!-- If an item has no `title`, substitute with descriptions. -->
        <text macro="title-and-descriptions-bib"/>
      </else>
    </choose>
  </macro>
  <macro name="author-title-substitute-short">
    <choose>
        <!-- If a review has no `reviewed-genre` or `reviewed-title`, assume that `title` contains the title of the reviewed work; the description provides it. -->
        <choose>
            <text macro="title-short"/>
          </if>
          <else-if variable="reviewed-genre reviewed-title title">
            <text macro="title-short"/>
          </else-if>
          <else>
            <text macro="title-and-descriptions-short"/>
          </else>
        </choose>
      </if>
      <else-if variable="title">
        <text macro="title-short"/>
      </else-if>
      <else>
        <!-- If an item has no `title`, substitute with descriptions and capitalize -->
        <text macro="title-and-descriptions-bib"/>
      </else>
    </choose>
  </macro>
  <macro name="author-title-substitute-container">
    <choose>
      <else-if match="any" type="article-magazine article-newspaper">
        <!-- Anonymous magazine and newspaper articles substitute name of publication (CMOS18 14.87, 14.97) -->
        <text macro="source-serial-name"/>
      </else-if>
      <else-if match="any" type="review review-book" variable="reviewed-author reviewed-genre reviewed-title">
        <!-- Publication name also substituted for unsigned reviews (CMOS18 14.102) -->
        <text macro="source-serial-name"/>
      </else-if>
      <else-if match="any" type="interview paper-conference">
        <choose>
            <!-- serial usage -->
            <text macro="source-serial-name"/>
          </if>
        </choose>
      </else-if>
      <else-if match="any" type="entry entry-dictionary entry-encyclopedia">
        <!-- Anonymous entries in reference works (CMOS18 14.130) -->
        <text font-style="italic" text-case="title" variable="container-title"/>
      </else-if>
      <else-if type="broadcast">
        <!-- TV broadcasts and podcasts (CMOS18 14.165, 14.168) -->
        <text font-style="italic" text-case="title" variable="container-title"/>
      </else-if>
      <else-if type="webpage">
        <!-- Website title substituted in bibliography only (CMOS18 14.104) -->
        <text text-case="title" variable="container-title"/>
      </else-if>
    </choose>
  </macro>
  <macro name="author-title-substitute-container-short">
    <choose>
      <else-if match="any" type="article-magazine article-newspaper">
        <!-- Anonymous magazine/newspaper articles substitute name of publication (CMOS18 14.87, 14.97) -->
        <text font-style="italic" form="short" text-case="title" variable="container-title"/>
      </else-if>
      <else-if match="any" type="review review-book" variable="reviewed-author reviewed-genre reviewed-title">
        <!-- Publication name also substituted for unsigned reviews (CMOS18 14.102) -->
        <text font-style="italic" form="short" text-case="title" variable="container-title"/>
      </else-if>
      <else-if match="any" type="interview paper-conference">
        <choose>
            <!-- serial usage -->
            <text font-style="italic" form="short" text-case="title" variable="container-title"/>
          </if>
        </choose>
      </else-if>
      <else-if match="any" type="entry entry-dictionary entry-encyclopedia">
        <!-- Anonymous entries in reference works (CMOS18 14.130) -->
        <text font-style="italic" form="short" text-case="title" variable="container-title"/>
      </else-if>
      <else-if type="broadcast">
        <!-- TV broadcasts and podcasts (CMOS18 14.165, 14.168) -->
        <text font-style="italic" form="short" text-case="title" variable="container-title"/>
      </else-if>
      <else-if type="webpage">
        <!-- Website title substituted in bibliography only (CMOS18 14.104) -->
        <text form="short" text-case="title" variable="container-title"/>
      </else-if>
    </choose>
  </macro>
  <!-- 2. Date (CMOS18 13.102) -->
  <macro name="date">
    <choose>
        <group delimiter=" ">
          <!-- reprints and earlier editions may give original year in brackets (CMOS18 14.16) -->
          <text macro="date-original-year" prefix="(" suffix=")"/>
          <group>
            <text macro="date-issued-year"/>
            <text variable="year-suffix"/>
          </group>
        </group>
      </if>
      <else-if variable="available-date">
        <date date-parts="year" form="text" variable="available-date"/>
      </else-if>
      <else-if variable="event-date">
        <date date-parts="year" form="text" variable="event-date"/>
      </else-if>
      <else-if variable="status">
        <group>
          <!-- Print the status variable rather than use generic CSL terms (`in press`, etc.) -->
          <text text-case="capitalize-first" variable="status"/>
          <text prefix="-" variable="year-suffix"/>
        </group>
      </else-if>
      <else-if type="collection">
        <!-- do not give n.d. for archival collections (CMOS18 14.128) -->
        <text prefix="-" variable="year-suffix"/>
      </else-if>
      <else-if type="manuscript">
        <!-- do not give n.d. with a bare shelfmark -->
        <choose>
            <text form="short" term="no date"/>
            <text prefix="-" variable="year-suffix"/>
          </if>
        </choose>
      </else-if>
      <else-if type="article-journal">
        <choose>
            <text form="short" term="no date"/>
          </if>
          <else-if match="any" variable="available-date collection-title issue supplement-number volume">
            <!-- journal articles should be forthcoming with an issue/volume but no date or locator (CMOS18 14.75) -->
            <text term="forthcoming"/>
          </else-if>
          <else>
            <text form="short" term="no date"/>
          </else>
        </choose>
        <text prefix="-" variable="year-suffix"/>
      </else-if>
      <else>
        <text form="short" term="no date"/>
        <text prefix="-" variable="year-suffix"/>
      </else>
    </choose>
  </macro>
  <macro name="date-short">
    <choose>
        <group delimiter=" ">
          <choose>
              <!-- Uncertain date already has square brackets -->
              <text macro="date-original-year"/>
            </if>
            <else>
              <text macro="date-original-year" prefix="[" suffix="]"/>
            </else>
          </choose>
          <group>
            <choose>
                <choose>
                    <!-- These variables indicate that the communication is retrievable by the reader. If not, then use the in-text-only personal communication format -->
                    <text macro="date-issued-full"/>
                  </if>
                  <else>
                    <text macro="date-issued-year"/>
                  </else>
                </choose>
              </if>
              <else>
                <text macro="date-issued-year"/>
              </else>
            </choose>
            <text variable="year-suffix"/>
          </group>
        </group>
      </if>
      <else-if variable="available-date">
        <date date-parts="year" form="text" variable="available-date"/>
      </else-if>
      <else-if variable="event-date">
        <date date-parts="year" form="text" variable="event-date"/>
      </else-if>
      <else-if variable="status">
        <!-- Print the status variable rather than use generic CSL terms (`in press`, etc.) -->
        <text text-case="lowercase" variable="status"/>
        <text prefix="-" variable="year-suffix"/>
      </else-if>
      <else>
        <choose>
            <choose>
                <!-- only give n.d. for accessible personal communication (CMOS18 14.111)-->
                <text form="short" term="no date"/>
              </if>
            </choose>
            <text prefix="-" variable="year-suffix"/>
          </if>
          <else-if match="any" type="classic collection entry entry-dictionary entry-encyclopedia">
            <!-- do not give n.d. for archival collections (CMOS18 14.128), `classic` (CMOS18 14.143), or reference entries (CMOS18 14.131) -->
            <text prefix="-" variable="year-suffix"/>
          </else-if>
          <else-if type="manuscript">
            <!-- do not give n.d. with a bare shelfmark -->
            <choose>
                <text form="short" term="no date"/>
                <text prefix="-" variable="year-suffix"/>
              </if>
            </choose>
          </else-if>
          <else-if type="article-journal">
            <choose>
                <text form="short" term="no date"/>
              </if>
              <else-if match="any" variable="available-date collection-title issue supplement-number volume">
                <!-- journal articles should be forthcoming with an issue/volume but no date or locator (CMOS18 14.75) -->
                <text term="forthcoming"/>
              </else-if>
              <else>
                <text form="short" term="no date"/>
              </else>
            </choose>
            <text prefix="-" variable="year-suffix"/>
          </else-if>
          <else>
            <text form="short" term="no date"/>
            <text prefix="-" variable="year-suffix"/>
          </else>
        </choose>
      </else>
    </choose>
  </macro>
  <macro name="date-sort">
    <!-- Sort items by issue date as printed by `source-date-issued-month-day` macro -->
    <choose>
        <date date-parts="year" form="text" variable="event-date"/>
      </if>
      <else-if match="any" type="article-journal article-magazine article-newspaper periodical post-weblog review review-book">
        <choose>
            <text macro="date-issued-leading-zeros-full"/>
          </if>
          <else-if match="any" variable="issue supplement-number volume">
            <text macro="date-issued-leading-zeros-year-month"/>
          </else-if>
          <else>
            <text macro="date-issued-leading-zeros-full"/>
          </else>
        </choose>
      </else-if>
      <else-if match="any" type="interview paper-conference">
        <choose>
            <!-- serial usage -->
            <choose>
                <text macro="date-issued-leading-zeros-year-month"/>
              </if>
              <else>
                <text macro="date-issued-leading-zeros-full"/>
              </else>
            </choose>
          </if>
          <else>
            <date date-parts="year" form="text" variable="issued"/>
          </else>
        </choose>
      </else-if>
      <else-if match="any" type="entry entry-dictionary entry-encyclopedia">
        <choose>
            <text macro="date-issued-leading-zeros-full"/>
          </if>
          <else>
            <date date-parts="year" form="text" variable="issued"/>
          </else>
        </choose>
      </else-if>
      <else-if match="any" type="article broadcast collection dataset document event graphic interview manuscript map patent performance personal_communication post software song speech standard webpage">
        <text macro="date-issued-leading-zeros-full"/>
      </else-if>
      <else>
        <date date-parts="year" form="text" variable="issued"/>
      </else>
    </choose>
  </macro>
  <macro name="date-sort-group">
    <!-- Sort items with and without dates (CMOS18 14.44):

          1. items with dates (= 0)
          2. `no date` items (= 1)
          3. items with `status` (forthcoming, in press, etc.) (= 2) -->
    <choose>
        <text value="0"/>
      </if>
      <else-if variable="status">
        <text value="2"/>
      </else-if>
      <else>
        <!-- n.d. -->
        <text value="1"/>
      </else>
    </choose>
  </macro>
  <!-- Date elements -->
  <macro name="date-issued-full">
    <choose>
        <!-- guessed-at date (CMOS18 14.44) -->
        <date form="text" prefix="[" suffix="?]" variable="issued"/>
      </if>
      <else>
        <date form="text" variable="issued"/>
      </else>
    </choose>
  </macro>
  <macro name="date-issued-leading-zeros-full">
    <date delimiter="-" variable="issued">
      <date-part name="year"/>
      <date-part form="numeric-leading-zeros" name="month"/>
      <date-part form="numeric-leading-zeros" name="day"/>
    </date>
  </macro>
  <macro name="date-issued-leading-zeros-year-month">
    <date delimiter="-" variable="issued">
      <date-part name="year"/>
      <date-part form="numeric-leading-zeros" name="month"/>
    </date>
  </macro>
  <macro name="date-issued-month">
    <date variable="issued">
      <date-part name="month"/>
    </date>
  </macro>
  <macro name="date-issued-month-day">
    <date variable="issued">
      <date-part name="month"/>
      <date-part name="day" prefix=" "/>
    </date>
  </macro>
  <macro name="date-issued-year">
    <choose>
        <!-- guessed-at date (CMOS18 14.44) -->
        <date date-parts="year" form="text" prefix="[" suffix="?]" variable="issued"/>
      </if>
      <else>
        <date date-parts="year" form="text" variable="issued"/>
      </else>
    </choose>
  </macro>
  <macro name="date-original-full">
    <choose>
        <date form="text" prefix="[" suffix="?]" variable="original-date"/>
      </if>
      <else>
        <date form="text" variable="original-date"/>
      </else>
    </choose>
  </macro>
  <macro name="date-original-year">
    <choose>
        <date date-parts="year" form="text" prefix="[" suffix="?]" variable="original-date"/>
      </if>
      <else>
        <date date-parts="year" form="text" variable="original-date"/>
      </else>
    </choose>
  </macro>
  <!-- 3. Title and descriptions (CMOS18 13.87-101) -->
  <macro name="title-and-descriptions-bib">
    <group delimiter=". ">
      <choose>
          <text macro="title-bib"/>
          <text macro="description-bib"/>
          <text macro="identifier-bib"/>
        </if>
        <else-if match="any" type="bill report">
          <!-- Bills, resolutions, and congressional reports substitute bill number if no title -->
          <!-- Congressional reports are indistinguishable from other reports -->
          <text macro="identifier-number-bib"/>
          <text macro="identifier-bib"/>
          <text macro="description-bib"/>
        </else-if>
        <else>
          <text macro="description-bib"/>
          <text macro="identifier-bib"/>
        </else>
      </choose>
    </group>
  </macro>
  <macro name="title-and-descriptions-short">
    <choose>
        <text macro="title-short"/>
      </if>
      <else-if match="any" type="bill report">
        <!-- Bills, resolutions, and congressional reports substitute bill number if no title -->
        <text macro="legal-identifier-bill-report"/>
      </else-if>
      <else>
        <text macro="description-short"/>
      </else>
    </choose>
  </macro>
  <macro name="title-and-source-bib">
    <group delimiter=". ">
      <choose>
          <!-- Bespoke `broadcast` format (CMOS18 14.165, 14.168) -->
          <text macro="source-monographic-title-bib"/>
          <group delimiter=", ">
            <text macro="identifier-number-bib"/>
            <text macro="title-bib"/>
            <text macro="description-bib"/>
            <text macro="source-monographic-identifier-contributors-bib"/>
          </group>
          <text macro="source-series-bib"/>
          <choose>
            <!-- show event information here only if not collapsed with `issued` (CMOS18 14.167) -->
              <text macro="source-event-bib"/>
            </if>
          </choose>
        </if>
        <else-if type="chapter" variable="container-title genre">
          <!-- 'Introduction to' etc. (CMOS18 14.12, 14.14) -->
          <group delimiter=" ">
            <text macro="title-and-descriptions-bib"/>
            <text macro="source-bib"/>
          </group>
        </else-if>
        <else>
          <text macro="title-and-descriptions-bib"/>
          <text macro="source-bib"/>
        </else>
      </choose>
      <group delimiter=", ">
        <choose>
          <!-- show event information here only if collapsed with `issued` (CMOS18 14.167) -->
          <!-- monographic usage only -->
          <else-if match="any" type="article-journal article-magazine article-newspaper periodical post-weblog review review-book"/>
          <else-if match="any" type="interview paper-conference">
            <choose>
                <!-- monographic usage -->
                <text macro="source-event-bib"/>
              </if>
            </choose>
          </else-if>
          <else>
            <text macro="source-event-bib"/>
          </else>
        </choose>
        <text macro="source-monographic-publication-bib"/>
      </group>
      <text macro="source-medium-bib"/>
      <text macro="source-archive-bib"/>
      <text macro="source-DOI-URL-bib"/>
    </group>
  </macro>
  <!-- 3.1. Title -->
  <macro name="title-bib">
    <choose>
        <!-- Handle `container-title` on `post` or `webpage` in manner of `publisher` -->
        <text macro="title-and-part-filter-review-bib"/>
      </if>
      <else-if match="any" type="article-journal article-magazine article-newspaper periodical post-weblog review review-book">
        <text macro="title-serial-bib"/>
      </else-if>
      <else-if match="any" type="interview paper-conference">
        <choose>
            <!-- monographic usage -->
            <text macro="title-monographic-bib"/>
          </if>
          <else>
            <!-- serial usage -->
            <text macro="title-serial-bib"/>
          </else>
        </choose>
      </else-if>
      <else>
        <text macro="title-monographic-bib"/>
      </else>
    </choose>
  </macro>
  <macro name="title-short">
    <choose>
        <!-- If a review has no `reviewed-title`, assume that `title` contains the title of the reviewed work; the description provides it. -->
        <choose>
            <!-- Quotes, title case -->
            <text form="short" quotes="true" text-case="title" variable="title"/>
          </if>
          <else-if variable="reviewed-genre reviewed-title title">
            <!-- Quotes, title case -->
            <text form="short" quotes="true" text-case="title" variable="title"/>
          </else-if>
          <else>
            <text macro="description-short"/>
          </else>
        </choose>
      </if>
      <else>
        <text macro="title-primary-short"/>
      </else>
    </choose>
  </macro>
  <!-- Title elements -->
  <macro name="title-and-part-filter-review-bib">
    <choose>
        <!-- `title` is only the review title if there is a separate `reviewed-genre` or `reviewed-title`; otherwise, it is the title of the reviewed work, printed in the description -->
        <choose>
            <text macro="title-and-part-title-bib"/>
          </if>
        </choose>
      </if>
      <else>
        <text macro="title-and-part-title-bib"/>
      </else>
    </choose>
  </macro>
  <macro name="title-and-part-title-bib">
    <group delimiter=". ">
      <text macro="title-primary"/>
      <group delimiter=", ">
        <text macro="label-part-number-capitalized"/>
        <text macro="title-part"/>
      </group>
    </group>
  </macro>
  <macro name="title-monographic-bib">
    <!-- For monographic items, assume `part-number` and `part-title` refer to the book/volume. -->
    <choose>
        <text macro="title-primary"/>
      </if>
      <!-- For monographic items without `container-title`, bibliography entries list `part-title` or `volume-title` first if available -->
      <else-if variable="part-title">
        <text font-style="italic" text-case="title" variable="part-title"/>
      </else-if>
      <else-if variable="volume-title">
        <text font-style="italic" text-case="title" variable="volume-title"/>
      </else-if>
      <else>
        <text macro="title-primary"/>
      </else>
    </choose>
  </macro>
  <macro name="title-part">
    <choose>
        <text quotes="true" text-case="title" variable="part-title"/>
      </if>
      <else-if match="any" type="interview paper-conference">
        <choose>
            <!-- monographic usage -->
            <text font-style="italic" text-case="title" variable="part-title"/>
          </if>
          <else>
            <!-- serial usage -->
            <text quotes="true" text-case="title" variable="part-title"/>
          </else>
        </choose>
      </else-if>
      <else>
        <text font-style="italic" text-case="title" variable="part-title"/>
      </else>
    </choose>
  </macro>
  <macro name="title-serial-bib">
    <!-- For serials, assume that `part-number` and `part-title` refer to the article and append to `title` -->
    <choose>
        <text macro="title-and-part-filter-review-bib"/>
      </if>
      <else>
        <!-- for serial items without `container-title`, don't append `volume-title` to `title` -->
        <text macro="title-and-part-filter-review-bib"/>
      </else>
    </choose>
  </macro>
  <macro name="title-primary">
    <choose>
        <!-- No italics or quotes, sentence case -->
        <text form="short" text-case="capitalize-first" variable="title"/>
      </if>
      <else-if match="any" type="bill collection legislation regulation treaty">
        <!-- No italics or quotes, title case -->
        <text text-case="title" variable="title"/>
      </else-if>
      <else-if type="legal_case">
        <!-- Italicized, sentence case -->
        <text font-style="italic" variable="title"/>
      </else-if>
      <else-if match="any" type="book classic graphic hearing map">
        <!-- Italicized, title case (regardless of `container-title`) -->
        <text font-style="italic" text-case="title" variable="title"/>
      </else-if>
      <else-if type="entry-encyclopedia" variable="author container-title">
        <!-- Signed encyclopedia entry in quotes, title case (CMOS18 14.132) -->
        <text quotes="true" text-case="title" variable="title"/>
      </else-if>
      <else-if type="entry-dictionary" variable="container-title">
        <!-- Quotes, sentence case -->
        <text quotes="true" variable="title"/>
      </else-if>
      <else-if type="entry-encyclopedia" variable="container-title">
        <!-- Quotes, sentence case -->
        <text quotes="true" variable="title"/>
      </else-if>
      <else-if type="post">
        <!-- Quotes, sentence case -->
        <text quotes="true" variable="title"/>
      </else-if>
      <!-- Other types are formatted based on presence of `container-title` -->
      <else-if variable="container-title">
        <!-- Quotes, title case -->
        <text quotes="true" text-case="title" variable="title"/>
      </else-if>
      <else-if match="any" type="article dataset document interview manuscript paper-conference personal_communication speech thesis webpage">
        <!-- Container-like but not necessarily with `container-title` -->
        <!-- Quotes, title case -->
        <text quotes="true" text-case="title" variable="title"/>
      </else-if>
      <else>
        <!-- Italicized, title case (default) -->
        <text font-style="italic" text-case="title" variable="title"/>
      </else>
    </choose>
  </macro>
  <macro name="title-primary-short">
    <choose>
        <!-- No italics or quotes, sentence case -->
        <text form="short" text-case="capitalize-first" variable="title"/>
      </if>
      <else-if match="any" type="bill collection legislation regulation treaty">
        <!-- No italics or quotes, title case -->
        <text form="short" text-case="title" variable="title"/>
      </else-if>
      <else-if type="legal_case">
        <!-- Italicized, sentence case -->
        <text font-style="italic" form="short" variable="title"/>
      </else-if>
      <else-if match="any" type="book classic graphic hearing map">
        <!-- Italicized, title case (regardless of `container-title`) -->
        <text font-style="italic" form="short" text-case="title" variable="title"/>
      </else-if>
      <else-if type="entry-encyclopedia" variable="author container-title">
        <!-- Signed encyclopedia entry in quotes, title case (CMOS18 14.132) -->
        <text form="short" quotes="true" text-case="title" variable="title"/>
      </else-if>
      <else-if type="entry-dictionary" variable="container-title">
        <!-- Quotes, sentence case -->
        <text form="short" quotes="true" variable="title"/>
      </else-if>
      <else-if type="entry-encyclopedia" variable="container-title">
        <!-- Quotes, sentence case -->
        <text form="short" quotes="true" variable="title"/>
      </else-if>
      <else-if type="post">
        <!-- Quotes, sentence case -->
        <text form="short" quotes="true" variable="title"/>
      </else-if>
      <!-- Other types are formatted based on presence of `container-title` -->
      <else-if variable="container-title">
        <!-- Quotes, title case -->
        <text form="short" quotes="true" text-case="title" variable="title"/>
      </else-if>
      <else-if match="any" type="article dataset document interview manuscript paper-conference personal_communication speech thesis webpage">
        <!-- Container-like but not necessarily with `container-title` -->
        <!-- Quotes, title case -->
        <text form="short" quotes="true" text-case="title" variable="title"/>
      </else-if>
      <else>
        <!-- Italicized, title case (default) -->
        <text font-style="italic" form="short" text-case="title" variable="title"/>
      </else>
    </choose>
  </macro>
  <!-- 3.2. Description -->
  <macro name="description-bib">
    <choose>
        <text macro="description-interview-bib"/>
      </if>
      <else-if match="any" type="review review-book" variable="reviewed-author reviewed-genre reviewed-title">
        <text macro="description-review-bib"/>
      </else-if>
      <else-if type="personal_communication">
        <text macro="description-letter-bib"/>
      </else-if>
      <else-if match="any" type="article-journal article-magazine article-newspaper periodical post-weblog review review-book">
        <text macro="description-serial-bib"/>
      </else-if>
      <else-if type="paper-conference">
        <text macro="description-paper-conference-bib"/>
      </else-if>
      <else-if type="song" variable="composer">
        <text macro="description-song-bib"/>
      </else-if>
      <!-- thesis type appears with university name (CMOS18 14.113) -->
      <else-if type="thesis"/>
      <else-if match="none" variable="container-title">
        <!-- Other description -->
        <text macro="description-format-bib"/>
      </else-if>
      <else>
        <text macro="description-generic-bib"/>
      </else>
    </choose>
  </macro>
  <macro name="description-short">
    <choose>
        <text macro="description-interview-short"/>
      </if>
      <else-if match="any" type="review review-book" variable="reviewed-author reviewed-genre reviewed-title">
        <text macro="description-review-short"/>
      </else-if>
      <else-if type="personal_communication">
        <text macro="description-letter-short"/>
      </else-if>
      <else-if match="any" type="article-journal article-magazine article-newspaper periodical post-weblog review review-book">
        <text macro="description-serial-short"/>
      </else-if>
      <else-if type="paper-conference">
        <choose>
            <!-- monographic usage -->
            <text macro="description-format-short"/>
          </if>
          <else>
            <!-- serial usage -->
            <text macro="description-serial-short"/>
          </else>
        </choose>
      </else-if>
      <else>
        <text macro="description-format-short"/>
      </else>
    </choose>
  </macro>
  <!-- Description elements -->
  <macro name="description-format-bib">
    <choose>
      <else-if variable="genre">
        <text text-case="capitalize-first" variable="genre"/>
      </else-if>
      <else-if type="manuscript">
        <!-- 'unpublished manuscript' if no `genre` (CMOS18 14.114) -->
        <choose>
            <text term="manuscript" text-case="capitalize-first"/>
          </if>
        </choose>
      </else-if>
      <else-if type="personal_communication">
        <!-- 'personal communication' if no `genre` (CMOS18 14.111) -->
        <choose>
            <text term="personal-communication" text-case="capitalize-first"/>
          </if>
        </choose>
      </else-if>
    </choose>
  </macro>
  <macro name="description-format-short">
    <choose>
        <text variable="genre"/>
      </if>
      <else-if variable="medium">
        <text variable="medium"/>
      </else-if>
      <else-if type="manuscript">
        <!-- 'unpublished manuscript' if no `genre` (CMOS18 14.114) -->
        <choose>
            <text term="manuscript"/>
          </if>
        </choose>
      </else-if>
      <else-if type="personal_communication">
        <!-- 'pers. comm.' if no `genre` (CMOS18 14.111) -->
        <choose>
            <text form="short" term="personal-communication"/>
          </if>
        </choose>
      </else-if>
    </choose>
  </macro>
  <macro name="description-generic-bib">
    <!-- For conference presentations/performances/events, chapters in reports/standards/generic documents, software, place description within the source element -->
    <choose>
        <choose>
            <!-- monographic usage -->
            <text macro="description-format-bib"/>
          </if>
        </choose>
      </if>
      <else-if match="none" type="document report software standard">
        <text macro="description-format-bib"/>
      </else-if>
    </choose>
  </macro>
  <macro name="description-interview-bib">
    <group delimiter=", ">
      <choose>
          <!-- `genre` printed with `number` -->
            <label form="verb" suffix=" " text-case="capitalize-first"/>
            <name/>
          </names>
        </if>
        <else-if variable="genre">
          <group delimiter=" ">
            <text text-case="capitalize-first" variable="genre"/>
            <group delimiter=" ">
              <text form="verb" term="container-author"/>
            </group>
          </group>
        </else-if>
        <else-if variable="interviewer">
            <label form="verb" suffix=" " text-case="capitalize-first"/>
            <name/>
          </names>
        </else-if>
        <else>
          <text macro="description-format-bib"/>
        </else>
      </choose>
      <text macro="source-event-place-first"/>
    </group>
  </macro>
  <macro name="description-interview-short">
    <choose>
          <label form="verb" suffix=" "/>
          <name/>
          <substitute>
            <text macro="description-format-short"/>
          </substitute>
        </names>
      </if>
      <else-if match="any" variable="genre medium">
        <choose>
            <!-- capitalize if no author or title -->
            <text macro="description-format-bib"/>
          </if>
          <else>
            <text macro="description-format-short"/>
          </else>
        </choose>
      </else-if>
      <else>
        <!-- generic description for an unpublished interview (CMOS18 14.108) -->
        <text term="interview"/>
      </else>
    </choose>
  </macro>
  <macro name="description-letter-bib">
    <choose>
        <group delimiter=", ">
          <choose>
              <!-- `genre` appears with `number` -->
                <label form="verb" suffix=" " text-case="capitalize-first"/>
                <name/>
              </names>
            </if>
            <else-if variable="genre">
              <group delimiter=" ">
                <text macro="description-format-bib"/>
                  <label form="verb" suffix=" "/>
                  <name/>
                </names>
              </group>
            </else-if>
            <else>
                <label form="verb" suffix=" " text-case="capitalize-first"/>
                <name/>
              </names>
            </else>
          </choose>
          <text variable="event-place"/>
          <date form="text" variable="event-date"/>
        </group>
      </if>
      <else>
        <text macro="description-format-bib"/>
      </else>
    </choose>
  </macro>
  <macro name="description-letter-short">
    <!-- shortened notes ideally give author, recipient, place, and date (CMOS18 14.13) -->
    <group delimiter=", ">
      <choose>
          <group delimiter=" ">
            <text macro="description-format-short"/>
              <label form="verb" suffix=" "/>
              <name/>
            </names>
          </group>
        </if>
        <else>
          <text macro="description-format-short"/>
        </else>
      </choose>
      <text variable="event-place"/>
      <date form="text" variable="event-date"/>
    </group>
  </macro>
  <macro name="description-paper-conference-bib">
    <choose>
        <!-- monographic usage -->
        <text macro="description-generic-bib"/>
      </if>
      <else>
        <!-- serial usage -->
        <group delimiter=". ">
          <text macro="description-serial-bib"/>
          <text macro="source-event-bib"/>
        </group>
      </else>
    </choose>
  </macro>
  <macro name="description-review-bib">
    <!-- Reviewed item -->
    <group delimiter=". ">
      <group delimiter=", ">
        <group delimiter=" ">
          <text macro="description-review-genre-bib"/>
          <text macro="description-review-title"/>
        </group>
        <choose>
              <label form="verb" suffix=" "/>
              <name/>
            </names>
          </if>
          <else-if variable="reviewed-genre"/>
          <else>
              <label form="verb" suffix=" "/>
              <name/>
            </names>
          </else>
        </choose>
        <text macro="source-event-place-first"/>
      </group>
      <text macro="label-section-capitalized"/>
    </group>
  </macro>
  <macro name="description-review-genre-bib">
    <choose>
        <group delimiter=" ">
          <text macro="description-review-term-unsigned-bib"/>
          <text variable="reviewed-genre"/>
          <choose>
                <label form="verb" suffix=" "/>
                <name/>
              </names>
            </if>
          </choose>
        </group>
      </if>
      <else-if variable="number">
        <text macro="description-review-term-unsigned-bib"/>
      </else-if>
      <!-- If no `reviewed-genre`, assume that `genre` is entered as 'Review of the book' or similar -->
      <else-if variable="genre">
        <text text-case="capitalize-first" variable="genre"/>
      </else-if>
      <else>
        <text macro="description-review-term-unsigned-bib"/>
      </else>
    </choose>
  </macro>
  <macro name="description-review-short">
    <group delimiter=" ">
      <text form="short" term="review-of"/>
      <text macro="description-review-title-short"/>
    </group>
  </macro>
  <macro name="description-review-term-unsigned-bib">
    <!-- Anonymous reviews appear as 'unsigned' (CMOS18 14.102) -->
    <choose>
        <choose>
            <text term="review-of" text-case="capitalize-first"/>
          </if>
          <else>
            <text form="short" term="review-of" text-case="capitalize-first"/>
          </else>
        </choose>
      </if>
      <else>
        <group delimiter=" ">
          <text term="anonymous" text-case="capitalize-first"/>
          <choose>
              <text term="review-of"/>
            </if>
            <else>
              <text form="short" term="review-of"/>
            </else>
          </choose>
        </group>
      </else>
    </choose>
  </macro>
  <macro name="description-review-title">
    <choose>
        <!-- Not possible to distinguish TV series episode from other reviewed works without a reviewed source title -->
        <!-- Adapt for `reviewed-container-title` or similar if it becomes available -->
        <text font-style="italic" text-case="title" variable="reviewed-title"/>
      </if>
      <else>
        <!-- Assume title is title of reviewed work -->
        <text font-style="italic" text-case="title" variable="title"/>
      </else>
    </choose>
  </macro>
  <macro name="description-review-title-short">
    <choose>
        <!-- Not possible to distinguish TV series episode from other reviewed works without a reviewed source title -->
        <!-- Adapt for `reviewed-container-title` or similar if it becomes available -->
        <text font-style="italic" form="short" text-case="title" variable="reviewed-title"/>
      </if>
      <else>
        <!-- Assume title is title of reviewed work -->
        <text font-style="italic" form="short" text-case="title" variable="title"/>
      </else>
    </choose>
  </macro>
  <macro name="description-serial-bib">
    <group delimiter=". ">
      <choose>
          <!-- move `genre` with special issue (CMOS18 14.77) or supplement (CMOS18 14.78) -->
          <text macro="description-format-bib"/>
        </if>
      </choose>
      <!-- `section` provides magazine departments (CMOS18 14.88) and newspaper column names (CMOS18 14.93) -->
      <text macro="label-section-capitalized"/>
    </group>
  </macro>
  <macro name="description-serial-short">
    <choose>
      <else-if variable="genre">
        <text macro="description-format-short"/>
      </else-if>
      <else>
        <text variable="section"/>
      </else>
    </choose>
  </macro>
  <macro name="description-song-bib">
    <!-- Performer of classical music works -->
    <!-- TODO: remove when Zotero fixes mapping of performer to `author` -->
    <group delimiter=" ">
      <!-- Based on `description-format` macro -->
      <choose>
          <text text-case="capitalize-first" variable="genre"/>
          <text form="verb" term="performer"/>
        </if>
        <!-- providing 'performed by' label for recorded readings (CMOS18 14.164), but it should be omitted for classical music (CMOS18 14.163) -->
        <else>
          <text form="verb" term="performer" text-case="capitalize-first"/>
        </else>
      </choose>
        <substitute>
        </substitute>
      </names>
    </group>
  </macro>
  <!-- 3.3. Identifier (edition, contributors, volume) -->
  <macro name="identifier-bib">
    <group delimiter=". ">
      <choose>
          <text macro="identifier-patent"/>
        </if>
        <else-if type="report">
          <text macro="identifier-report-bib"/>
        </else-if>
        <else-if match="any" type="post webpage">
          <!-- Handle `container-title` on `post` or `webpage` as `publisher` -->
          <text macro="identifier-number-bib"/>
          <text macro="label-version-capitalized"/>
          <text macro="identifier-edition-bib"/>
          <text macro="identifier-contributors-bib"/>
          <text macro="identifier-volume-monographic-bib"/>
        </else-if>
        <else-if variable="container-title">
          <choose>
              <!-- For audiovisual media, number information comes after `title`, not `container-title`; `song` places album catalogue `number` with `publisher` (CMOS18 14.163-164) -->
              <text macro="identifier-number-bib"/>
            </if>
          </choose>
          <text macro="identifier-contributors-bib"/>
        </else-if>
        <else>
          <choose>
              <text macro="identifier-number-bib"/>
            </if>
          </choose>
          <text macro="label-version-capitalized"/>
          <text macro="identifier-edition-bib"/>
          <choose>
              <text macro="identifier-contributors-bib"/>
            </if>
            <else-if match="any" variable="number-of-volumes part-number volume">
              <!-- `collection-editor` belongs with `collection-title` if item is not multivolume -->
              <choose>
                    <label form="verb" suffix=" " text-case="capitalize-first"/>
                    <name/>
                  </names>
                </if>
                <else>
                  <text macro="identifier-contributors-bib"/>
                </else>
              </choose>
            </else-if>
            <else>
              <text macro="identifier-contributors-bib"/>
            </else>
          </choose>
          <text macro="identifier-volume-monographic-bib"/>
          <choose>
            <!-- `collection-editor` supplied in `identifier-volume-monographic-bib` if there is a `part-title` or `volume-title` -->
            <else-if match="any" variable="number-of-volumes part-number volume">
              <choose>
                  <text macro="identifier-contributors-bib"/>
                </if>
              </choose>
            </else-if>
          </choose>
        </else>
      </choose>
    </group>
  </macro>
  <!-- Identifier elements -->
  <macro name="identifier-contributors-bib">
    <choose>
        <text macro="identifier-contributors-serial-bib"/>
      </if>
      <else-if match="any" type="interview paper-conference">
        <choose>
            <!-- monographic usage -->
            <text macro="identifier-contributors-monographic-bib"/>
          </if>
          <else>
            <!-- serial usage -->
            <text macro="identifier-contributors-serial-bib"/>
          </else>
        </choose>
      </else-if>
      <else>
        <text macro="identifier-contributors-monographic-bib"/>
      </else>
    </choose>
  </macro>
  <macro name="identifier-contributors-monographic-bib">
    <group delimiter=". ">
      <choose>
          <group delimiter=". ">
              <label form="verb" suffix=" " text-case="capitalize-first"/>
              <name/>
            </names>
              <label form="verb" suffix=" " text-case="capitalize-first"/>
              <name/>
            </names>
              <label form="verb" suffix=" " text-case="capitalize-first"/>
              <name/>
            </names>
              <label form="verb" suffix=" " text-case="capitalize-first"/>
              <name/>
            </names>
              <label form="verb" suffix=" " text-case="capitalize-first"/>
              <name/>
            </names>
              <label form="verb" suffix=" " text-case="capitalize-first"/>
              <name/>
            </names>
              <label form="verb" suffix=" " text-case="capitalize-first"/>
              <name/>
            </names>
              <label form="verb" suffix=" " text-case="capitalize-first"/>
              <name/>
            </names>
              <label form="verb" suffix=" " text-case="capitalize-first"/>
              <name/>
            </names>
              <label form="verb" suffix=" " text-case="capitalize-first"/>
              <name/>
            </names>
              <label form="verb" suffix=" " text-case="capitalize-first"/>
              <name/>
            </names>
              <label form="verb" suffix=" " text-case="capitalize-first"/>
              <name/>
            </names>
            <choose>
                  <label form="verb" suffix=" " text-case="capitalize-first"/>
                  <name/>
                </names>
              </if>
            </choose>
              <label form="verb" suffix=" " text-case="capitalize-first"/>
              <name/>
            </names>
            <choose>
                  <label form="verb" suffix=" " text-case="capitalize-first"/>
                  <name/>
                </names>
              </if>
            </choose>
          </group>
        </if>
        <else>
          <!-- Handle `container-title` on `post` or `webpage` as `publisher` -->
          <group delimiter=". ">
            <choose>
                  <label form="verb" suffix=" " text-case="capitalize-first"/>
                  <name/>
                </names>
                  <label form="verb" suffix=" " text-case="capitalize-first"/>
                  <name/>
                </names>
                  <label form="verb" suffix=" " text-case="capitalize-first"/>
                  <name/>
                </names>
                  <label form="verb" suffix=" " text-case="capitalize-first"/>
                  <name/>
                </names>
                  <label form="verb" suffix=" " text-case="capitalize-first"/>
                  <name/>
                </names>
                  <label form="verb" suffix=" " text-case="capitalize-first"/>
                  <name/>
                </names>
              </if>
            </choose>
              <label form="verb" suffix=" " text-case="capitalize-first"/>
              <name/>
            </names>
              <label form="verb" suffix=" " text-case="capitalize-first"/>
              <name/>
            </names>
            <choose>
                  <label form="verb" suffix=" " text-case="capitalize-first"/>
                  <name/>
                </names>
                  <label form="verb" suffix=" " text-case="capitalize-first"/>
                  <name/>
                </names>
                  <label form="verb" suffix=" " text-case="capitalize-first"/>
                  <name/>
                </names>
                  <label form="verb" suffix=" " text-case="capitalize-first"/>
                  <name/>
                </names>
                <choose>
                      <label form="verb" suffix=" " text-case="capitalize-first"/>
                      <name/>
                    </names>
                  </if>
                </choose>
                  <label form="verb" suffix=" " text-case="capitalize-first"/>
                  <name/>
                </names>
                <choose>
                      <label form="verb" suffix=" " text-case="capitalize-first"/>
                      <name/>
                    </names>
                  </if>
                </choose>
              </if>
            </choose>
            <choose>
                <!-- Song contributors attached to album (CMOS18 14.163) -->
                  <label form="verb" suffix=" " text-case="capitalize-first"/>
                  <name/>
                </names>
              </if>
            </choose>
          </group>
        </else>
      </choose>
    </group>
  </macro>
  <macro name="identifier-contributors-serial-bib">
    <group delimiter=". ">
        <label form="verb" suffix=" " text-case="capitalize-first"/>
        <name/>
      </names>
        <label form="verb" suffix=" " text-case="capitalize-first"/>
        <name/>
      </names>
        <label form="verb" suffix=" " text-case="capitalize-first"/>
        <name/>
      </names>
        <label form="verb" suffix=" " text-case="capitalize-first"/>
        <name/>
      </names>
        <label form="verb" suffix=" " text-case="capitalize-first"/>
        <name/>
      </names>
        <label form="verb" suffix=" " text-case="capitalize-first"/>
        <name/>
      </names>
        <label form="verb" suffix=" " text-case="capitalize-first"/>
        <name/>
      </names>
    </group>
  </macro>
  <macro name="identifier-edition-bib">
    <choose>
        <text macro="label-edition-capitalized"/>
      </if>
      <else-if variable="original-title">
        <text macro="label-edition-capitalized"/>
      </else-if>
    </choose>
  </macro>
  <macro name="identifier-number-bib">
    <group delimiter=" ">
      <choose>
          <text text-case="capitalize-first" variable="genre"/>
          <text variable="number"/>
        </if>
        <else-if is-numeric="number" type="broadcast">
          <text text-case="capitalize-first" value="episode"/>
          <text variable="number"/>
        </else-if>
        <else-if variable="number">
          <text text-case="title" variable="genre"/>
          <text macro="label-number-capitalized"/>
        </else-if>
      </choose>
    </group>
  </macro>
  <macro name="identifier-patent">
    <group delimiter=", ">
      <group delimiter=" ">
        <!-- `authority`: US ; `genre`: patent ; `number`: 123,445 -->
        <text form="short" variable="authority"/>
        <!-- 'US Patent' capitalized in both bibliography and note forms -->
        <choose>
            <text text-case="capitalize-first" variable="genre"/>
          </if>
          <else>
            <text term="patent" text-case="capitalize-first"/>
          </else>
        </choose>
        <text variable="number"/>
      </group>
      <group delimiter=" ">
        <text value="filed"/>
        <date form="text" variable="submitted"/>
      </group>
      <group delimiter=" ">
        <choose>
            <text term="and"/>
          </if>
        </choose>
        <text value="issued"/>
        <!-- Always give full issue date, even in author-date (CMOS18 14.158) -->
        <text macro="date-issued-full"/>
      </group>
    </group>
  </macro>
  <macro name="identifier-report-bib">
    <group delimiter=". ">
      <choose>
          <!-- If the report is a chapter in a larger report, then most identifying information is printed in the source. -->
          <text macro="identifier-contributors-bib"/>
        </if>
        <else-if variable="title">
          <text macro="identifier-number-bib"/>
          <text macro="label-version-capitalized"/>
          <text macro="identifier-edition-bib"/>
          <text macro="identifier-contributors-bib"/>
          <text macro="identifier-volume-monographic-bib"/>
        </else-if>
        <else>
          <!-- If there is no `title`, then `genre` and `number` are already printed as the title. -->
          <text macro="label-version-capitalized"/>
          <text macro="identifier-edition-bib"/>
          <text macro="identifier-contributors-bib"/>
          <text macro="identifier-volume-monographic-bib"/>
        </else>
      </choose>
    </group>
  </macro>
  <macro name="identifier-volume-bib">
    <!-- In notes styles, bibliography entries may be listed either under an individual volume title or its series, but the former approach is required for author-date, which is the form that this macro implements (CMOS18 14.21) -->
    <group delimiter=", ">
      <choose>
          <!-- part and title with individual titles -->
          <group delimiter=" ">
            <text macro="label-part-number-capitalized"/>
            <text value="of"/>
            <text font-style="italic" text-case="title" variable="volume-title"/>
          </group>
          <group delimiter=" ">
            <text macro="label-volume"/>
            <text value="of"/>
            <group delimiter=", ">
              <text macro="title-primary"/>
                <label form="verb" suffix=" "/>
                <name/>
              </names>
            </group>
          </group>
        </if>
        <else-if match="any" variable="part-title volume-title">
          <group delimiter=" ">
            <choose>
                <group delimiter=", ">
                  <text macro="label-volume-capitalized"/>
                  <text macro="label-part-number"/>
                  <text value="of"/>
                </group>
              </if>
              <else-if variable="part-number">
                <text macro="label-part-number-capitalized"/>
                <text value="of"/>
              </else-if>
              <else-if variable="volume">
                <text macro="label-volume-capitalized"/>
                <text value="of"/>
              </else-if>
            </choose>
            <group delimiter=", ">
              <text macro="title-primary"/>
                <label form="verb" suffix=" "/>
                <name/>
              </names>
            </group>
          </group>
        </else-if>
        <else-if variable="part-number volume">
          <text macro="label-volume-capitalized"/>
          <text macro="label-part-number"/>
        </else-if>
        <else-if variable="part-number">
          <text macro="label-part-number-capitalized"/>
        </else-if>
        <else-if variable="volume">
          <text macro="label-volume-capitalized"/>
        </else-if>
        <else>
          <text macro="label-number-of-volumes"/>
        </else>
      </choose>
    </group>
  </macro>
  <macro name="identifier-volume-monographic-bib">
    <choose>
      <else-if match="any" type="interview paper-conference">
        <choose>
            <!-- monographic usage -->
            <text macro="identifier-volume-bib"/>
          </if>
        </choose>
      </else-if>
      <else>
        <text macro="identifier-volume-bib"/>
      </else>
    </choose>
  </macro>
  <!-- 4. Source -->
  <macro name="source-bib">
    <group delimiter=". ">
      <choose>
          <!-- Serial items -->
          <text macro="source-serial-bib"/>
        </if>
        <else-if match="any" type="interview paper-conference">
          <choose>
              <!-- monographic usage -->
              <text macro="source-monographic-bib"/>
            </if>
            <else>
              <!-- serial usage -->
              <text macro="source-serial-bib"/>
            </else>
          </choose>
        </else-if>
        <else-if match="any" type="patent post webpage"/>
        <else>
          <text macro="source-monographic-bib"/>
        </else>
      </choose>
    </group>
  </macro>
  <!-- 4.1. Serial sources -->
  <macro name="source-serial-bib">
    <group delimiter=". ">
      <text macro="source-serial-title-volume-bib"/>
      <choose>
          <group delimiter=", ">
            <text macro="source-serial-title-bib"/>
            <text macro="source-serial-identifier-bib"/>
          </group>
        </if>
        <else-if variable="collection-title volume">
          <group delimiter=", ">
            <text macro="source-serial-title-bib"/>
            <text macro="source-serial-identifier-bib"/>
          </group>
        </else-if>
        <else-if variable="volume">
          <group delimiter=" ">
            <text macro="source-serial-title-bib"/>
            <text macro="source-serial-identifier-bib"/>
          </group>
        </else-if>
        <else>
          <group delimiter=", ">
            <text macro="source-serial-title-bib"/>
            <text macro="source-serial-identifier-bib"/>
          </group>
        </else>
      </choose>
    </group>
  </macro>
  <!-- Serial source title -->
  <macro name="source-serial-name">
    <group delimiter=" ">
      <text font-style="italic" text-case="title" variable="container-title"/>
      <choose>
        <!-- TODO: remove conditional when Zotero stops double-mapping `event-place` and `publisher-place` -->
          <text prefix="(" suffix=")" variable="publisher-place"/>
        </if>
      </choose>
    </group>
  </macro>
  <macro name="source-serial-title-bib">
    <group delimiter=", ">
      <choose>
        <!-- Journal special issues (CMOS18 14.77) and supplements (CMOS18 14.78) -->
        <else-if variable="supplement-number volume-title">
          <text term="supplement" text-case="capitalize-first"/>
        </else-if>
        <else-if type="periodical" variable="supplement-number title">
          <text term="supplement" text-case="capitalize-first"/>
        </else-if>
        <else-if match="any" type="periodical" variable="volume-title">
          <choose>
              <text text-case="capitalize-first" variable="genre"/>
            </if>
            <else-if variable="volume-title">
              <text term="special-issue" text-case="capitalize-first"/>
            </else-if>
            <else-if type="periodical" variable="editor title">
              <text term="special-issue" text-case="capitalize-first"/>
            </else-if>
          </choose>
        </else-if>
      </choose>
      <text macro="source-serial-name"/>
      <choose>
        <!-- 'ahead of print' is placed akin to a series (CMOS18 14.75) -->
        <else-if type="article-journal" variable="DOI issued">
          <text term="advance-online-publication"/>
        </else-if>
      </choose>
    </group>
  </macro>
  <macro name="source-serial-title-volume-bib">
    <choose>
        <!-- Journal special issues (CMOS18 14.77) and supplements (CMOS18 14.78) -->
        <group delimiter=", ">
          <group delimiter=" ">
            <text macro="source-monographic-preposition-bib"/>
            <text quotes="true" text-case="title" variable="volume-title"/>
          </group>
          <text macro="source-monographic-identifier-contributors-bib"/>
        </group>
      </if>
    </choose>
  </macro>
  <!-- Serial source identifier -->
  <macro name="source-serial-identifier-bib">
    <choose>
        <group delimiter=": ">
          <text macro="source-serial-identifier-volume-author-date"/>
          <text macro="source-serial-locator"/>
        </group>
      </if>
      <else>
        <group delimiter=", ">
          <group delimiter=". ">
            <text macro="source-serial-identifier-volume-author-date"/>
            <!-- periodical edition always capitalized (CMOS18 14.89) -->
            <text macro="label-edition-capitalized"/>
          </group>
          <text macro="source-serial-locator"/>
        </group>
      </else>
      <!-- TODO: If CSL adds `date-part` detection, add two further conditions to address CMOS18 14.74: delimiting with ":" if there is a `volume` and no month or `issue` or `supplement number`; delimiting with ", " or there is an `issue` or `supplement number` and no month -->
    </choose>
  </macro>
  <macro name="source-serial-identifier-volume-author-date">
    <group delimiter=", ">
      <choose>
          <!-- newspapers provide the full date in place of volume/issue numbers (CMOS18 14.89) -->
          <text variable="collection-title"/>
          <text macro="source-serial-volume-status-bib"/>
        </if>
        <else-if match="any" variable="issue supplement-number volume">
          <choose>
              <!-- date appears first if the magazine or review `container-title` has been substituted for a missing author (CMOS18 14.87, 14.102) -->
              <choose>
                  <choose>
                    <!-- no extra date details with a volume plus issue/supplement -->
                    <else-if variable="supplement-number"/>
                    <!-- nothing to substitute if there is no issue/supplement/volume -->
                    <else-if match="none" variable="issue volume"/>
                    <else>
                      <text macro="source-date-issued-month-day"/>
                    </else>
                  </choose>
                </if>
              </choose>
            </if>
          </choose>
          <!-- `collection-title` is for any serial with multiple series (e.g. '4th ser.') -->
          <text variable="collection-title"/>
          <group delimiter=" ">
            <choose>
                <choose>
                    <text macro="label-volume"/>
                  </if>
                  <else-if match="any" type="article-magazine review review-book" variable="reviewed-author reviewed-genre reviewed-title">
                    <!-- provide label if a magazine or review `container-title` has been substituted for a missing author (CMOS18 14.87, 14.102) -->
                    <choose>
                        <text variable="volume"/>
                      </if>
                      <!-- TODO: when CSL provides date part detection, volume should be lowercase if there is a month, but otherwise capitalized -->
                      <else>
                        <text macro="label-volume-capitalized"/>
                      </else>
                    </choose>
                  </else-if>
                  <else>
                    <text variable="volume"/>
                  </else>
                </choose>
                <group delimiter=", " prefix="(" suffix=")">
                  <choose>
                      <text variable="issue"/>
                      <text macro="label-supplement-number"/>
                    </if>
                    <else-if match="any" type="article-magazine review review-book" variable="reviewed-author reviewed-genre reviewed-title">
                      <!-- date for anonymous magazine and review articles only appears here if it did not earlier (CMOS18 14.87, 14.102) -->
                      <choose>
                          <text macro="source-date-issued-month-day"/>
                        </if>
                      </choose>
                    </else-if>
                    <else>
                      <text macro="source-date-issued-month-day"/>
                    </else>
                  </choose>
                </group>
              </if>
              <else-if match="any" variable="issue supplement-number">
                <group delimiter=" ">
                  <group delimiter=", ">
                    <text macro="label-issue"/>
                    <text macro="label-supplement-number"/>
                  </group>
                  <choose>
                      <text macro="source-date-issued-month-day" prefix="(" suffix=")"/>
                    </if>
                  </choose>
                </group>
              </else-if>
            </choose>
          </group>
        </else-if>
        <else>
          <text variable="collection-title"/>
          <choose>
              <!-- publisher possible with `interview` (cf. CMOS18 14.110) -->
              <text variable="publisher"/>
            </if>
          </choose>
          <text macro="source-serial-volume-status-bib"/>
        </else>
      </choose>
    </group>
  </macro>
  <macro name="source-serial-volume-status-bib">
    <group delimiter=", ">
      <choose>
          <group delimiter=" ">
            <!-- article accepted for publication and available on publisher website (CMOS18 14.75) -->
            <!-- TODO: use CSL term for `available-date` when available -->
            <text value="accepted"/>
            <date form="text" variable="available-date"/>
          </group>
        </if>
      </choose>
      <group delimiter=" ">
        <text macro="source-date-status-bib"/>
        <text macro="source-date-bib"/>
      </group>
    </group>
  </macro>
  <!-- Serial source locator -->
  <macro name="source-serial-locator">
    <choose>
        <!-- Page numbers cited in notes appear alongside article ID (CMOS18 14.71) -->
        <group delimiter=", ">
          <text macro="label-locator"/>
          <text variable="number"/>
        </group>
      </if>
      <!-- do not give pages for newspapers (CMOS18 14.89) -->
      <else-if type="article-newspaper"/>
      <else>
        <text variable="page"/>
      </else>
    </choose>
  </macro>
  <!-- 4.2. Monographic sources -->
  <macro name="source-monographic-bib">
    <group delimiter=". ">
      <!-- Monographic sources repeat main reference elements -->
      <choose>
          <group delimiter=", ">
            <group delimiter=" ">
              <choose>
                  <text macro="source-monographic-preposition-bib"/>
                </if>
              </choose>
              <text macro="source-monographic-title-bib"/>
            </group>
            <text macro="source-monographic-description-bib"/>
            <text macro="source-monographic-identifier-bib"/>
            <text macro="source-monographic-locator"/>
          </group>
        </if>
      </choose>
      <text macro="source-series-bib"/>
      <choose>
        <!-- show event information here only if not collapsed with `issued` (CMOS18 14.167) -->
          <text macro="source-event-bib"/>
        </if>
      </choose>
    </group>
  </macro>
  <!-- Monographic source title -->
  <macro name="source-monographic-preposition-bib">
    <choose>
        <text value="to"/>
      </if>
      <else-if match="any" type="entry entry-dictionary entry-encyclopedia">
        <choose>
            <!-- Give preposition only for signed entries; otherwise, title is substituted -->
            <text term="in" text-case="capitalize-first"/>
          </if>
        </choose>
      </else-if>
      <else-if variable="chapter-number page">
        <text term="in" text-case="capitalize-first"/>
      </else-if>
      <else-if variable="chapter-number">
        <group delimiter=" ">
          <text macro="label-chapter-number-capitalized"/>
          <choose>
              <text term="on"/>
            </if>
            <else>
              <text term="in"/>
            </else>
          </choose>
        </group>
      </else-if>
      <else>
        <text term="in" text-case="capitalize-first"/>
      </else>
    </choose>
  </macro>
  <macro name="source-monographic-title-bib">
    <choose>
        <text font-style="italic" text-case="title" variable="part-title"/>
      </if>
      <else-if variable="volume-title">
        <text font-style="italic" text-case="title" variable="volume-title"/>
      </else-if>
      <else>
        <text font-style="italic" text-case="title" variable="container-title"/>
      </else>
    </choose>
  </macro>
  <!-- Monographic source description -->
  <macro name="source-monographic-description-bib">
    <choose>
        <!-- Conference presentations should describe the session unless published in a proceedings -->
        <choose>
            <!-- serial usage -->
            <text macro="description-format-bib"/>
          </if>
        </choose>
      </if>
      <else-if type="software">
        <!-- For entries in mobile app reference works, place description after `container-title` -->
        <text macro="description-format-bib"/>
      </else-if>
      <else-if match="any" type="document report standard">
        <!-- For chapters in report, standards, and generic documents, place description after `container-title` -->
        <text macro="description-format-bib"/>
      </else-if>
    </choose>
  </macro>
  <!-- Monographic source identifier -->
  <macro name="source-monographic-identifier-bib">
    <!-- Based on `identifier-bib` -->
    <choose>
        <group delimiter=", ">
          <choose>
              <!-- For audiovisual media, number information comes after `title`, not `container-title`; `song` places album catalogue `number` with `publisher` (CMOS18 14.163-164) -->
              <text macro="identifier-number-bib"/>
            </if>
          </choose>
          <text macro="label-version"/>
          <text macro="label-edition"/>
          <choose>
              <text macro="source-monographic-identifier-contributors-bib"/>
            </if>
            <else-if match="any" variable="number-of-volumes part-number volume">
              <!-- `collection-editor` belongs with `collection-title` if item is not multivolume -->
              <choose>
                    <label form="verb" suffix=" "/>
                    <name/>
                  </names>
                </if>
                <else>
                  <text macro="source-monographic-identifier-contributors-bib"/>
                </else>
              </choose>
            </else-if>
            <else>
              <text macro="source-monographic-identifier-contributors-bib"/>
            </else>
          </choose>
          <text macro="source-monographic-identifier-volume-bib"/>
          <choose>
            <!-- `collection-editor` supplied in `source-monographic-identifier-volume-bib` if there is a `part-title` or `volume-title` -->
            <else-if match="any" variable="number-of-volumes part-number volume">
              <choose>
                  <text macro="source-monographic-identifier-contributors-bib"/>
                </if>
              </choose>
            </else-if>
          </choose>
        </group>
      </if>
    </choose>
  </macro>
  <macro name="source-monographic-identifier-contributors-bib">
    <group delimiter=", ">
        <label form="verb" suffix=" "/>
        <name/>
      </names>
        <label form="verb" suffix=" "/>
        <name/>
      </names>
        <label form="verb" suffix=" "/>
        <name/>
      </names>
        <label form="verb" suffix=" "/>
        <name/>
      </names>
        <label form="verb" suffix=" "/>
        <name/>
      </names>
        <label form="verb" suffix=" "/>
        <name/>
      </names>
        <label form="verb" suffix=" "/>
        <name/>
      </names>
        <label form="verb" suffix=" "/>
        <name/>
      </names>
        <label form="verb" suffix=" "/>
        <name/>
      </names>
        <label form="verb" suffix=" "/>
        <name/>
      </names>
      <choose>
            <label form="verb" suffix=" "/>
            <name/>
          </names>
        </if>
      </choose>
        <label form="verb" suffix=" "/>
        <name/>
      </names>
        <label form="verb" suffix=" "/>
        <name/>
      </names>
      <choose>
          <!-- Song contributors attached to album (CMOS18 14.163) -->
            <label form="verb" suffix=" "/>
            <name/>
          </names>
        </if>
      </choose>
    </group>
  </macro>
  <macro name="source-monographic-identifier-volume-bib">
    <!-- Mostly identical to `identifier-volume-bib` but without capitalization; giving `container-title` rather than `title-primary`; and ensuring volume number -->
    <group delimiter=", ">
      <choose>
          <!-- part and title with individual titles -->
          <group delimiter=" ">
            <text macro="label-part-number"/>
            <text value="of"/>
            <text font-style="italic" text-case="title" variable="volume-title"/>
          </group>
          <group delimiter=" ">
            <text macro="label-volume"/>
            <text value="of"/>
            <group delimiter=", ">
              <text font-style="italic" text-case="title" variable="container-title"/>
                <label form="verb" suffix=" "/>
                <name/>
              </names>
            </group>
          </group>
        </if>
        <else-if match="any" variable="part-title volume-title">
          <group delimiter=" ">
            <choose>
                <group delimiter=", ">
                  <text macro="label-volume"/>
                  <text macro="label-part-number"/>
                  <text value="of"/>
                </group>
              </if>
              <else-if variable="part-number">
                <text macro="label-part-number"/>
                <text value="of"/>
              </else-if>
              <else-if variable="volume">
                <text macro="label-volume"/>
                <text value="of"/>
              </else-if>
            </choose>
            <group delimiter=", ">
              <text font-style="italic" text-case="title" variable="container-title"/>
                <label form="verb" suffix=" "/>
                <name/>
              </names>
            </group>
          </group>
        </else-if>
        <else-if match="any" variable="part-number volume">
          <choose>
              <text macro="label-volume"/>
            </if>
            <else-if is-numeric="volume" variable="page">
              <choose>
                <!-- check for variables that might come between the volume and page number -->
                  <text macro="label-volume"/>
                </if>
              </choose>
            </else-if>
            <else>
              <text macro="label-volume"/>
            </else>
          </choose>
          <text macro="label-part-number"/>
        </else-if>
        <else>
          <text macro="label-number-of-volumes"/>
        </else>
      </choose>
    </group>
  </macro>
  <!-- Monographic source locator -->
  <macro name="source-monographic-locator">
    <choose>
        <group delimiter=":">
          <choose>
              <text variable="volume"/>
            </if>
          </choose>
          <text variable="locator"/>
        </group>
      </if>
      <else-if variable="locator">
        <text macro="label-locator"/>
      </else-if>
      <else-if is-numeric="volume" variable="page">
        <!-- collapse the volume and page number if adjacent -->
        <group delimiter=":">
          <choose>
            <!-- check for variables that might come between the volume and page number -->
              <text variable="volume"/>
            </if>
          </choose>
          <text variable="page"/>
        </group>
      </else-if>
      <else>
        <text variable="page"/>
      </else>
    </choose>
  </macro>
  <!-- 4.3. Series -->
  <macro name="source-series-bib">
    <group delimiter=", ">
      <choose>
          <choose>
              <text macro="source-series-title"/>
            </if>
            <else>
              <text text-case="title" variable="collection-title"/>
                <label form="verb" suffix=" "/>
                <name/>
              </names>
              <text macro="label-collection-number"/>
              <text macro="label-issue"/>
            </else>
          </choose>
        </if>
        <else>
          <text macro="source-series-title"/>
        </else>
      </choose>
    </group>
  </macro>
  <macro name="source-series-title">
    <group delimiter=", ">
      <choose>
          <text text-case="title" variable="collection-title"/>
          <text macro="label-collection-number"/>
          <text macro="label-issue"/>
        </if>
        <else-if is-numeric="collection-number" variable="collection-title">
          <group delimiter=" ">
            <text text-case="title" variable="collection-title"/>
            <text variable="collection-number"/>
          </group>
        </else-if>
        <else-if variable="collection-title">
          <text text-case="title" variable="collection-title"/>
          <text variable="collection-number"/>
        </else-if>
      </choose>
    </group>
  </macro>
  <!-- 4.4. Event -->
  <macro name="source-event-bib">
    <group delimiter=" ">
      <choose>
        <!-- omit types that provide event information in description  -->
        <else-if type="personal_communication" variable="recipient"/>
        <else-if match="any" type="review review-book" variable="reviewed-author reviewed-genre reviewed-title"/>
        <else-if match="any" variable="event event-date event-title">
          <!-- TODO: To prevent Zotero from printing `event-place`, due to its double-mapping of `publisher-place` and `event-place`. Remove this when that is changed. -->
          <choose>
              <choose>
                  <!-- Don't print event info for conference papers published in proceedings -->
                  <text macro="source-event-status-bib"/>
                  <text macro="source-event-description-bib"/>
                </if>
              </choose>
            </if>
            <else>
              <!-- For other item types, print event info even if published (e.g. collection catalogs, performance programs). -->
              <text macro="source-event-status-bib"/>
              <text macro="source-event-description-bib"/>
            </else>
          </choose>
        </else-if>
      </choose>
    </group>
  </macro>
  <macro name="source-event-place-first">
    <!-- for descriptive elements for interviews, reviews, letters -->
    <choose>
        <group delimiter=", ">
          <text variable="event-title"/>
          <text variable="event-place"/>
          <date form="text" variable="event-date"/>
        </group>
      </if>
    </choose>
  </macro>
  <macro name="source-event-status-bib">
    <group delimiter=" ">
      <choose>
          <!-- 'aired', 'performed', etc. (CMOS18 14.165) -->
          <text text-case="capitalize-first" variable="status"/>
        </if>
        <else-if type="paper-conference">
          <choose>
              <text text-case="capitalize-first" value="presented"/>
            </if>
            <else>
              <text form="short" term="paper-conference" text-case="capitalize-first"/>
              <text value="presented"/>
            </else>
          </choose>
          <choose>
              <text term="at"/>
            </if>
          </choose>
        </else-if>
        <else-if type="song">
          <text text-case="capitalize-first" value="recorded"/>
          <choose>
              <text term="at"/>
            </if>
          </choose>
        </else-if>
        <else-if variable="event-date issued"/>
        <else-if match="none" variable="issued">
          <text text-case="capitalize-first" variable="status"/>
        </else-if>
      </choose>
    </group>
  </macro>
  <macro name="source-event-title">
    <choose>
      <!-- TODO: We expect `event-title` to be used, but processors and applications may not be updated yet. This macro ensures that either `event` or `event-title` can be accepted. Remove if processor logic and application adoption can handle this. -->
        <text variable="event-title"/>
      </if>
      <else>
        <text variable="event"/>
      </else>
    </choose>
  </macro>
  <macro name="source-event-title-capitalized">
    <choose>
      <!-- TODO: We expect `event-title` to be used, but processors and applications may not be updated yet. This macro ensures that either `event` or `event-title` can be accepted. Remove if processor logic and application adoption can handle this. -->
        <text text-case="capitalize-first" variable="event-title"/>
      </if>
      <else>
        <text text-case="capitalize-first" variable="event"/>
      </else>
    </choose>
  </macro>
  <macro name="source-event-description-bib">
    <group delimiter=", ">
      <choose>
          <text macro="source-event-title"/>
        </if>
        <else-if type="paper-conference" variable="genre">
          <text macro="source-event-title-capitalized"/>
        </else-if>
        <else-if type="paper-conference">
          <text macro="source-event-title"/>
        </else-if>
        <else>
          <text macro="source-event-title-capitalized"/>
        </else>
      </choose>
      <date form="text" variable="event-date"/>
      <text variable="event-place"/>
    </group>
  </macro>
  <!-- 4.5. Facts of publication -->
  <macro name="source-monographic-publication-bib">
    <group delimiter=". ">
      <choose>
        <!-- Provide only for monographic types -->
        <else-if match="any" type="interview paper-conference">
          <choose>
              <!-- monographic usage -->
              <text macro="source-publication-and-date-bib"/>
            </if>
          </choose>
        </else-if>
        <!-- `patent` date in identification (CMOS18 14.158) -->
        <else-if type="patent"/>
        <else>
          <text macro="source-publication-and-date-bib"/>
        </else>
      </choose>
      <text macro="source-publication-original-title-bib"/>
    </group>
  </macro>
  <macro name="source-publication-and-date-bib">
    <group delimiter=", ">
      <choose>
          <!-- `container-title` functions like a publisher with social media and website sources (CMOS18 14.104-106) -->
          <text text-case="title" variable="container-title"/>
        </if>
      </choose>
      <choose>
          <!-- a podcast publisher appears before the date, whereas the network of an aired show appears after (CMOS18 14.165); unfortunately CSL stores both in `publisher` -->
          <!-- TODO: `DOI` or `URL` detection is the only way to distinguish radio/TV from podcasts, but it is obviously imprecise; modify if CSL provides a `podcast` type -->
          <text macro="source-publication-history-bib"/>
        </if>
        <else-if type="broadcast" variable="URL">
          <text macro="source-publication-history-bib"/>
        </else-if>
        <else-if type="broadcast"/>
        <else>
          <text macro="source-publication-history-bib"/>
        </else>
      </choose>
      <group delimiter=" ">
        <text macro="source-date-status-bib"/>
        <text macro="source-date-bib"/>
      </group>
      <choose>
        <else-if type="broadcast">
          <group delimiter=" ">
            <text term="on"/>
            <text macro="source-publication-history-bib"/>
          </group>
        </else-if>
      </choose>
    </group>
  </macro>
  <!-- Facts of publication elements -->
  <macro name="source-publication-description-bib">
    <choose>
      <else-if type="article">
        <!-- `preprint` term attached to repository name, but specific working paper descriptors appear in description (CMOS18 14.76, 14.116) -->
        <text term="preprint" text-case="capitalize-first"/>
      </else-if>
      <else-if type="thesis">
        <!-- thesis type appears with university name (CMOS18 14.113) -->
        <text macro="description-format-bib"/>
      </else-if>
      <else-if match="any" variable="original-publisher original-publisher-place">
        <choose>
          <!-- `edition` provides an alternative label to `reprint` (CMOS18 14.16) -->
          <else-if match="none" type="book chapter classic entry entry-dictionary entry-encyclopedia interview musical_score pamphlet paper-conference report thesis"/>
          <else-if variable="issued original-date">
            <text text-case="capitalize-first" value="reprint"/>
          </else-if>
        </choose>
      </else-if>
    </choose>
  </macro>
  <macro name="source-publication-history-bib">
    <choose>
        <!-- `original-title` is covered in `source-publication-original-title-bib` -->
        <group delimiter=", ">
          <text macro="source-publication-description-bib"/>
          <text macro="source-publication-publisher-bib"/>
        </group>
      </if>
      <else-if match="any" variable="edition original-publisher original-publisher-place">
        <group delimiter=". ">
          <!-- full stop to separate original date if `original-publisher` (CMOS18 14.16) -->
          <group delimiter=", ">
            <text macro="source-publication-publisher-original-bib"/>
            <text macro="source-date-original"/>
          </group>
          <group delimiter=". ">
            <choose>
                <text macro="label-edition-capitalized"/>
              </if>
            </choose>
            <group delimiter=", ">
              <text macro="source-publication-description-bib"/>
              <text macro="source-publication-publisher-bib"/>
            </group>
          </group>
        </group>
      </else-if>
      <else>
        <group delimiter="; ">
          <!-- semicolon to separate original date if no publisher (CMOS18 14.165) -->
          <text macro="source-date-original"/>
          <group delimiter=", ">
            <text macro="source-publication-description-bib"/>
            <text macro="source-publication-publisher-bib"/>
          </group>
        </group>
      </else>
    </choose>
  </macro>
  <macro name="source-publication-original-title-bib">
    <!-- Work originally published under a different title (CMOS18 13.101) -->
    <choose>
        <group delimiter=" ">
          <text term="original-work-published" text-case="capitalize-first"/>
          <group delimiter=", ">
            <text font-style="italic" text-case="title" variable="original-title"/>
          </group>
          <group delimiter=", " prefix="(" suffix=")">
            <text macro="source-publication-publisher-original-bib"/>
            <text macro="source-date-original"/>
          </group>
        </group>
      </if>
    </choose>
  </macro>
  <macro name="source-publication-publisher-bib">
    <group delimiter=" ">
      <choose>
          <text text-case="capitalize-first" variable="publisher"/>
        </if>
        <else-if variable="publisher">
          <group delimiter=": ">
            <text text-case="capitalize-first" variable="publisher-place"/>
            <text text-case="capitalize-first" variable="publisher"/>
          </group>
        </else-if>
        <!-- TODO: remove conditional when Zotero fixes double-mapping of `event-place` -->
        <else-if match="any" variable="event-date event-title"/>
        <else>
          <text text-case="capitalize-first" variable="publisher-place"/>
        </else>
      </choose>
      <choose>
          <!-- Album catalogue number follows label name (CMOS18 14.163-164) -->
          <text variable="number"/>
        </if>
      </choose>
    </group>
  </macro>
  <macro name="source-publication-publisher-original-bib">
    <choose>
        <group delimiter=": ">
          <text text-case="capitalize-first" variable="original-publisher-place"/>
          <text text-case="capitalize-first" variable="original-publisher"/>
        </group>
      </if>
      <else>
        <text text-case="capitalize-first" variable="original-publisher-place"/>
      </else>
    </choose>
  </macro>
  <!-- 4.6. Date -->
  <macro name="source-date-bib">
    <choose>
        <!-- TODO: Is there a better CSL variable for a date of a multivolume work (CMOS18 14.21)? -->
        <date date-parts="year" form="text" variable="available-date"/>
      </if>
      <else-if variable="available-date part-title">
        <date date-parts="year" form="text" variable="available-date"/>
      </else-if>
      <else>
        <text macro="source-date-issued-full"/>
        <!-- for author-date 18th edition: -->
        <!-- <text macro="source-date-issued-month-day"/> -->
      </else>
    </choose>
  </macro>
  <!-- Date elements -->
  <macro name="source-date-issued-full">
    <!-- Give full date for more ephemeral types; reflected in `date-sort` -->
    <!-- NB: any changes must also be applied to `source-date-original-full` -->
    <choose>
        <!-- Provide issue date for letters listed under event-date -->
        <text macro="date-issued-year"/>
      </if>
      <else-if match="any" type="article-journal article-magazine article-newspaper periodical post-weblog review review-book">
        <text macro="source-date-issued-full-serial"/>
      </else-if>
      <else-if match="any" type="interview paper-conference">
        <choose>
            <!-- monographic usage -->
            <text macro="date-issued-year"/>
          </if>
          <else>
            <!-- serial usage -->
            <text macro="source-date-issued-full-serial"/>
          </else>
        </choose>
      </else-if>
      <else-if match="any" type="entry entry-dictionary entry-encyclopedia">
        <choose>
            <!-- Online reference works use full dates (CMOS18 14.131) -->
            <text macro="date-issued-full"/>
          </if>
          <else>
            <text macro="date-issued-year"/>
          </else>
        </choose>
      </else-if>
      <else-if match="any" type="article broadcast collection dataset document event graphic interview manuscript map patent performance personal_communication post software song speech standard webpage">
        <text macro="date-issued-full"/>
      </else-if>
      <else-if variable="issued">
        <text macro="date-issued-year"/>
      </else-if>
      <else-if variable="available-date">
        <!-- possible recourse for multivolume series (e.g. CMOS18 14.26) -->
        <date date-parts="year" form="text" variable="available-date"/>
      </else-if>
      <else-if variable="event-date">
        <date date-parts="year" form="text" variable="event-date"/>
      </else-if>
    </choose>
  </macro>
  <macro name="source-date-issued-full-serial">
    <choose>
        <text macro="date-issued-full"/>
      </if>
      <else-if variable="issue volume">
        <date date-parts="year-month" form="text" variable="issued"/>
      </else-if>
      <else-if variable="supplement-number">
        <date date-parts="year-month" form="text" variable="issued"/>
      </else-if>
      <else-if match="any" variable="issue volume">
        <date date-parts="year-month" form="text" variable="issued"/>
      </else-if>
      <else>
        <text macro="date-issued-full"/>
      </else>
    </choose>
  </macro>
  <macro name="source-date-issued-month-day">
    <!-- Variant for author-date styles -->
    <!-- Give full date for more ephemeral types; reflected in `date-sort` -->
    <!-- NB: any changes must also be applied to `date-sort` and `source-date-original-month-day` -->
    <choose>
        <!-- Provide issue date for letters listed under event-date -->
        <text macro="date-issued-year"/>
      </if>
      <else-if match="any" type="article-journal article-magazine article-newspaper periodical post-weblog review review-book">
        <text macro="source-date-issued-month-day-serial"/>
      </else-if>
      <else-if match="any" type="interview paper-conference">
        <choose>
            <!-- serial usage -->
            <text macro="source-date-issued-month-day-serial"/>
          </if>
        </choose>
      </else-if>
      <else-if match="any" type="entry entry-dictionary entry-encyclopedia">
        <choose>
            <!-- Online reference works use full dates (CMOS18 14.131) -->
            <text macro="date-issued-month-day"/>
          </if>
        </choose>
      </else-if>
      <else-if match="any" type="article broadcast collection dataset document event graphic interview manuscript map patent performance personal_communication post software song speech standard webpage">
        <text macro="date-issued-month-day"/>
      </else-if>
    </choose>
  </macro>
  <macro name="source-date-issued-month-day-serial">
    <choose>
        <!-- newspapers provide the full date in place of volume/issue numbers (CMOS18 14.89) -->
        <text macro="date-issued-month-day"/>
      </if>
      <else-if match="any" variable="issue supplement-number volume">
        <text macro="date-issued-month"/>
      </else-if>
      <else>
        <text macro="date-issued-month-day"/>
      </else>
    </choose>
  </macro>
  <macro name="source-date-original">
    <text macro="source-date-original-full"/>
    <!-- form for author-date from 18th edition: -->
    <!-- <text macro="source-date-original-month-day"/> -->
  </macro>
  <macro name="source-date-original-full">
    <!-- Give full date for more ephemeral types; reflected in `date-sort` -->
    <!-- Macro derived from `source-date-issued-full` -->
    <choose>
        <!-- Provide original date for letters listed under event-date -->
        <text macro="date-original-year"/>
      </if>
      <else-if match="any" type="article-journal article-magazine article-newspaper periodical post-weblog review review-book">
        <text macro="source-date-original-full-serial"/>
      </else-if>
      <else-if match="any" type="interview paper-conference">
        <choose>
            <!-- monographic usage -->
            <text macro="date-original-year"/>
          </if>
          <else>
            <!-- serial usage -->
            <text macro="source-date-original-full-serial"/>
          </else>
        </choose>
      </else-if>
      <else-if match="any" type="entry entry-dictionary entry-encyclopedia">
        <choose>
            <!-- Online reference works use full dates (CMOS18 14.131) -->
            <text macro="date-original-full"/>
          </if>
          <else>
            <text macro="date-original-year"/>
          </else>
        </choose>
      </else-if>
      <else-if match="any" type="article broadcast collection dataset document event graphic interview manuscript map patent performance personal_communication post software song speech standard webpage">
        <text macro="date-original-full"/>
      </else-if>
      <else>
        <text macro="date-original-year"/>
      </else>
    </choose>
  </macro>
  <macro name="source-date-original-full-serial">
    <choose>
        <date date-parts="year-month" form="text" variable="original-date"/>
      </if>
      <else-if variable="supplement-number">
        <date date-parts="year-month" form="text" variable="original-date"/>
      </else-if>
      <else-if match="any" variable="issue volume">
        <date date-parts="year-month" form="text" variable="original-date"/>
      </else-if>
      <else>
        <text macro="date-original-full"/>
      </else>
    </choose>
  </macro>
  <macro name="source-date-status-bib">
    <choose>
      <!-- on a `broadcast`, if there is an `event-title`, `status` appears with `event-date` as part of `source-event` (CMOS18 14.165) -->
      <else-if variable="issued status">
        <!-- `status` specifies date type, e.g. 'effective', 'last modified', 'approved' (CMOS18 14.104 for `webpage`; CMOS18 14.159 for `standard`) -->
        <choose>
            <text variable="status"/>
          </if>
          <else>
            <text text-case="capitalize-first" variable="status"/>
          </else>
        </choose>
      </else-if>
      <else-if type="broadcast" variable="issued URL"/>
      <else-if type="broadcast" variable="issued">
        <!-- `status` of a radio or TV broadcast is 'aired' if unspecified (CMOS18 14.165) -->
        <text text-case="capitalize-first" value="aired"/>
      </else-if>
      <else-if type="software" variable="issued publisher">
        <!-- `status` of software is 'released' if unspecified (CMOS18 14.169) -->
        <choose>
            <!-- lowercase if `publisher` is adjacent -->
            <text value="released"/>
          </if>
          <else>
            <text text-case="capitalize-first" value="released"/>
          </else>
        </choose>
      </else-if>
      <else-if type="software" variable="original-date">
        <!-- lowercase if `original-date` is adjacent -->
        <text value="released"/>
      </else-if>
      <else-if type="software" variable="issued">
        <!-- capitalize if `publisher` is not present -->
        <text text-case="capitalize-first" value="released"/>
      </else-if>
    </choose>
  </macro>
  <!-- 4.7. Locator (including page references) -->
  <macro name="source-locator-author-date">
    <choose>
        <choose>
            <text macro="label-locator"/>
          </if>
          <else-if variable="container-title title">
            <!-- unsigned reference entry title appears in the locator (CMOS18 13.130) -->
            <group delimiter=" ">
              <choose>
                  <!-- Only print reference entries use `sub-verbo` (CMOS18 14.131) -->
                  <text form="short" term="sub-verbo"/>
                </if>
              </choose>
              <text form="short" quotes="true" variable="title"/>
            </group>
          </else-if>
        </choose>
      </if>
      <else>
        <text macro="label-locator"/>
      </else>
    </choose>
  </macro>
  <!-- 4.8. Medium -->
  <macro name="source-medium-bib">
    <group delimiter=", ">
      <text text-case="capitalize-first" variable="medium"/>
      <text variable="scale"/>
      <text variable="dimensions"/>
    </group>
  </macro>
  <!-- 4.9. Archival location -->
  <macro name="source-archive-bib">
    <choose>
      <!-- With `archive_collection` or `archive-place`: physical archives. Without: digital archives (database and identifier) -->
        <text macro="source-archive-name-first"/>
      </if>
      <else-if match="any" type="collection document manuscript" variable="archive_collection archive-place">
        <text macro="source-archive-location-first-bib"/>
      </else-if>
      <else>
        <text macro="source-archive-identifier"/>
      </else>
    </choose>
  </macro>
  <macro name="source-archive-note">
    <choose>
      <!-- With `archive_collection` or `archive-place`: physical archives -->
        <text macro="source-archive-name-first"/>
      </if>
      <else-if match="any" type="collection document manuscript" variable="archive_collection archive-place">
        <text macro="source-archive-location-first-note"/>
      </else-if>
      <!-- Without `archive_collection` or `archive-place`: digital archives (database and identifier) -->
      <else>
        <text macro="source-archive-identifier"/>
      </else>
    </choose>
  </macro>
  <!-- Archival elements -->
  <macro name="source-archive-identifier">
    <choose>
        <!-- database identifier: the only example is `thesis`, but presumably this is for all types (CMOS18 14.113) -->
        <group delimiter=" ">
          <text variable="archive"/>
          <text prefix="(" suffix=")" variable="archive_location"/>
        </group>
      </if>
      <else>
        <group delimiter=", ">
          <text variable="archive"/>
          <text variable="archive_location"/>
        </group>
      </else>
    </choose>
  </macro>
  <macro name="source-archive-location-first-bib">
    <!-- Order of elements begins with the most specific (CMOS18 14.119, 14.127) -->
    <!-- In note styles, the bibliography generally provide entries for a `collection` rather than individual items (CMOS18 14.120, 14.128) -->
    <group delimiter=". ">
      <group delimiter=", ">
        <text text-case="capitalize-first" variable="archive_location"/>
        <text variable="archive_collection"/>
      </group>
      <group delimiter=", ">
        <text variable="archive"/>
        <text variable="archive-place"/>
      </group>
    </group>
  </macro>
  <macro name="source-archive-location-first-note">
    <!-- Order of elements begins with the most specific (CMOS18 14.119, 14.127) -->
    <!-- In note styles, the bibliography generally provide entries for a `collection` rather than individual items (CMOS18 14.120, 14.128) -->
    <group delimiter=", ">
      <group delimiter=", ">
        <text variable="archive_location"/>
        <text variable="archive_collection"/>
      </group>
      <group delimiter=", ">
        <text variable="archive"/>
        <text variable="archive-place"/>
      </group>
    </group>
  </macro>
  <macro name="source-archive-name-first">
    <!-- Archive (gallery) name first for art (CMOS18 14.133) -->
    <group delimiter=", ">
      <text variable="archive"/>
      <text variable="archive-place"/>
      <text variable="archive_collection"/>
      <text variable="archive_location"/>
    </group>
  </macro>
  <!-- 4.10. URL or persistent identifier -->
  <macro name="source-DOI-URL-bib">
    <choose>
        <text prefix="https://doi.org/" variable="DOI"/>
      </if>
      <else-if variable="URL">
        <group delimiter=". ">
          <choose>
              <group delimiter=" ">
                <text term="accessed" text-case="capitalize-first"/>
                <date form="text" variable="accessed"/>
              </group>
            </if>
          </choose>
          <text variable="URL"/>
        </group>
      </else-if>
    </choose>
  </macro>
  <macro name="source-DOI-URL">
    <!-- Alias to avoid modifying legal references block shared with APA -->
    <text macro="source-DOI-URL-bib"/>
  </macro>
  <!-- 5. Notes -->
  <macro name="notes">
    <!-- Notes on source element: original publication, reprint info, retraction info -->
    <text variable="references"/>
  </macro>
  <!-- 6. Legal references: Bluebook style (shared with APA) -->
  <macro name="legal-reference">
    <!-- Type usage:

         `bill`
         : bills, resolutions, federal reports

         `legal_case`
         : all legal and court cases

         `hearing`
         : hearings and testimony

         `legislation`
         : statutes, constitutional items, and charters

         `regulation`
         : codified regulations, uncodified regulations, executive orders

         `treaty`
         : treaties
    -->
    <group delimiter=" ">
      <choose>
          <group delimiter=", " suffix=".">
            <!-- APA generally defers to Bluebook for legal citations, but diverges without explanation for treaty items. We follow the Bluebook format that was used in APA 6th ed. -->
            <!-- APA manual omits treaty parties/authors, but per Bluebook they should be included at least for bilateral treaties. -->
            <text macro="legal-title"/>
            <text macro="legal-author"/>
            <text macro="legal-date"/>
            <!-- APA manual omits treaty source/report called for by Bluebook in favor of just URL. Both are included here, following the APA style used for all other item types to end the reference with a period, then give the URL afterward. -->
            <text macro="legal-source"/>
          </group>
        </if>
        <else>
          <group delimiter=" " suffix=".">
            <group delimiter=", ">
              <text macro="legal-title"/>
              <text macro="legal-source"/>
            </group>
            <text macro="legal-date"/>
            <text macro="legal-identifier"/>
          </group>
        </else>
      </choose>
      <text variable="references"/>
      <text macro="source-DOI-URL"/>
    </group>
  </macro>
  <!-- 6.1. Legal author -->
  <macro name="legal-author">
      <name delimiter="-" form="short"/>
    </names>
  </macro>
  <!-- 6.2. Legal date -->
  <macro name="legal-date">
    <choose>
        <text macro="date-issued-full"/>
      </if>
      <else-if type="legal_case">
        <text macro="legal-date-case"/>
      </else-if>
      <else-if match="any" type="bill hearing legislation regulation">
        <group delimiter=" " prefix="(" suffix=")">
          <group delimiter=" ">
            <text macro="date-original-year"/>
            <text form="symbol" term="and"/>
          </group>
          <choose>
              <!-- APA manual includes "rev." before the revision year, but this isn't part of the Bluebook rules. -->
              <text macro="date-issued-year"/>
            </if>
            <else>
              <!-- Show proposal date for uncodified regulations. Assume date is entered literally ala "proposed May 23, 2016". -->
              <!-- TODO: Add `proposed` date here if that becomes available -->
              <date form="text" variable="submitted"/>
            </else>
          </choose>
        </group>
      </else-if>
    </choose>
  </macro>
  <macro name="legal-date-case">
    <group delimiter=" " prefix="(" suffix=")">
      <text variable="authority"/>
      <choose>
          <!-- Print only year for cases published in reporters-->
          <text macro="date-issued-year"/>
        </if>
        <else>
          <text macro="date-issued-full"/>
        </else>
      </choose>
    </group>
  </macro>
  <!-- 6.3.1. Legal title -->
  <macro name="legal-title">
    <choose>
        <text text-case="title" variable="title"/>
      </if>
      <else-if type="hearing">
        <!-- APA uses a comma delimiter and omits "hearing before the" for hearings with testimony, but follows Bluebook rules (colon delimiter, prefix before the committee name) for references to the whole hearing. We simply follow the Bluebook rules for both, but use APA style capitalization (not capitalizing "Before" or the title of the hearing). -->
        <group delimiter=": " font-style="italic">
          <text text-case="capitalize-first" variable="title"/>
          <group delimiter=" ">
            <text term="hearing" text-case="capitalize-first"/>
            <group delimiter=" ">
              <group delimiter=" ">
                <!-- APA manual omits the bill number, but it should be included per Bluebook if relevant -->
                <text term="on"/>
                <text variable="number"/>
              </group>
              <group delimiter=" ">
                <!-- Use the `at` term to hold "before the" -->
                <text term="at"/>
                <text variable="section"/>
              </group>
            </group>
          </group>
        </group>
      </else-if>
    </choose>
  </macro>
  <!-- 6.3.2. Legal identifier -->
  <macro name="legal-identifier">
    <choose>
        <group delimiter=" " prefix="(" suffix=")">
          <!-- Use the 'verb' form of the hearing term to hold 'testimony of' -->
          <text form="verb" term="hearing"/>
            <name initialize="false"/>
          </names>
        </group>
      </if>
      <else-if match="any" type="bill legislation regulation">
        <!-- For uncodified regulations, assume future code section is in `status`. -->
        <text prefix="(" suffix=")" variable="status"/>
      </else-if>
    </choose>
  </macro>
  <macro name="legal-identifier-bill-report">
    <group delimiter=" ">
      <text variable="genre"/>
      <choose>
          <text variable="number"/>
        </if>
        <else>
          <!-- If there is no legislative body, session number, or code/record title, assume the item is a congressional report and include 'No.' label. -->
          <text macro="label-number-capitalized"/>
        </else>
      </choose>
    </group>
  </macro>
  <!-- 6.4. Legal source -->
  <macro name="legal-source">
    <!-- Expect legal item `container-title` to be stored in short form -->
    <choose>
        <text macro="legal-source-bill"/>
      </if>
      <else-if type="hearing">
        <text macro="legal-source-hearing"/>
      </else-if>
      <else-if type="legal_case">
        <text macro="legal-source-case"/>
      </else-if>
      <else-if type="legislation">
        <text macro="legal-source-legislation"/>
      </else-if>
      <else-if type="regulation">
        <text macro="legal-source-regulation"/>
      </else-if>
      <else-if type="treaty">
        <text macro="legal-source-treaty"/>
      </else-if>
    </choose>
  </macro>
  <!-- Legal source types -->
  <macro name="legal-source-bill">
    <group delimiter=", ">
      <text macro="legal-identifier-bill-report"/>
      <group delimiter=" ">
        <text variable="authority"/>
        <!-- 'session' is `chapter-number` -->
        <text variable="chapter-number"/>
      </group>
      <group delimiter=" ">
        <text variable="volume"/>
        <text variable="container-title"/>
        <text variable="page-first"/>
      </group>
    </group>
  </macro>
  <macro name="legal-source-case">
    <group delimiter=" ">
      <choose>
          <group delimiter=" ">
            <text variable="volume"/>
            <text variable="container-title"/>
            <text macro="label-section-symbol"/>
            <choose>
                <text variable="page-first"/>
              </if>
              <else>
                <text value="___"/>
              </else>
            </choose>
          </group>
        </if>
        <else>
          <text macro="label-number-capitalized"/>
        </else>
      </choose>
    </group>
  </macro>
  <macro name="legal-source-hearing">
    <group delimiter=" ">
      <text variable="authority"/>
      <!-- 'session' is `chapter-number` -->
      <text variable="chapter-number"/>
    </group>
  </macro>
  <macro name="legal-source-legislation">
    <choose>
        <!-- There's a public law number. -->
        <group delimiter=", ">
          <group delimiter=" ">
            <choose>
                <text text-case="capitalize-first" variable="genre"/>
              </if>
              <else>
                <text form="short" term="legislation" text-case="capitalize-first"/>
              </else>
            </choose>
            <text macro="label-number-capitalized"/>
          </group>
          <group delimiter=" ">
            <text variable="volume"/>
            <text variable="container-title"/>
            <text variable="page-first"/>
          </group>
        </group>
      </if>
      <else>
        <group delimiter=" ">
          <text variable="volume"/>
          <text variable="container-title"/>
          <choose>
              <text macro="label-section-symbol"/>
            </if>
            <else>
              <text variable="page-first"/>
            </else>
          </choose>
        </group>
      </else>
    </choose>
  </macro>
  <macro name="legal-source-regulation">
    <group delimiter=", ">
      <group delimiter=" ">
        <text variable="genre"/>
        <text macro="label-number-capitalized"/>
      </group>
      <group delimiter=" ">
        <text variable="volume"/>
        <text variable="container-title"/>
        <choose>
            <text macro="label-section-symbol"/>
          </if>
          <else>
            <text variable="page-first"/>
          </else>
        </choose>
      </group>
    </group>
  </macro>
  <macro name="legal-source-treaty">
    <group delimiter=" ">
      <number variable="volume"/>
      <text variable="container-title"/>
      <choose>
          <text variable="page-first"/>
        </if>
        <else>
          <text macro="label-number-capitalized"/>
        </else>
      </choose>
    </group>
  </macro>
  <!-- Citation -->
  <macro name="citation-author-date">
    <!-- Usage:
    
    -->
    <choose>
        <!-- with `classic`, a non-numeric canonical reference or identifying number is separated by a space rather than a comma (CMOS18 14.145) -->
        <choose>
            </group>
          <else-if locator="chapter line verse" match="any">
            </group>
          </else-if>
          <else>
            </group>
          </else>
        </choose>
      <else>
        </group>
      </else>
    </choose>
  </macro>
  <macro name="citation-author-date-item">
    <group delimiter=", ">
      <choose>
          <text macro="author-inline"/>
          <choose>
              <text macro="title-and-descriptions-short"/>
            </if>
          </choose>
        </if>
        <else-if match="any" variable="event-date issued">
          <choose>
              <choose>
                  <group delimiter=" ">
                    <text macro="author-inline"/>
                    <text macro="date-short"/>
                  </group>
                </if>
                <else>
                  <!-- unpublished `interview` or `personal_communication` use inline format (CMOS18 14.111) -->
                  <text macro="author-inline"/>
                  <text macro="title-and-descriptions-short"/>
                  <text macro="date-short"/>
                </else>
              </choose>
            </if>
            <else>
              <group delimiter=" ">
                <text macro="author-inline"/>
                <text macro="date-short"/>
              </group>
            </else>
          </choose>
        </else-if>
        <else>
          <!--- Comma with forthcoming or n.d. -->
          <text macro="author-inline"/>
          <choose>
              <choose>
                  <!-- unpublished `interview` or `personal_communication` use inline format (CMOS18 14.111) -->
                  <text macro="title-and-descriptions-short"/>
                </if>
              </choose>
            </if>
          </choose>
          <text macro="date-short"/>
        </else>
      </choose>
    </group>
  </macro>
  <citation after-collapse-delimiter="; " collapse="year" disambiguate-add-givenname="true" disambiguate-add-names="true" disambiguate-add-year-suffix="true" et-al-min="4" et-al-use-first="1" givenname-disambiguation-rule="primary-name-with-initials">
    <layout delimiter="; " prefix="(" suffix=")">
      <text macro="citation-author-date"/>
    </layout>
  </citation>
  <!-- Bibliography -->
  <macro name="bibliography-author-date">
    <choose>
        <!-- Legal items have different orders and delimiters -->
        <text macro="legal-reference"/>
      </if>
      <else>
        <group delimiter=". ">
          <text macro="author-bib"/>
          <text macro="date"/>
          <text macro="title-and-source-bib"/>
          <text macro="notes"/>
        </group>
      </else>
    </choose>
  </macro>
  <macro name="bibliography-filtered-author-date">
    <!-- usage:
    -->
    <choose>
        <choose>
        </choose>
      <else-if match="any" type="entry entry-dictionary entry-encyclopedia">
        <choose>
            <!-- Signed reference entries appear in the bibliography (CMOS18 14.132) -->
          <else-if match="any" variable="DOI URL">
            <!-- Provide a bibliography if necessary identifying information is not in text -->
          </else-if>
        </choose>
      </else-if>
      <else-if match="any" type="interview personal_communication">
        <choose>
            <!-- Personal communications only appear in the bibliography if the reader can retrieve them (CMOS18 14.13, 14.111) -->
        </choose>
      </else-if>
      <else>
      </else>
    </choose>
  </macro>
  <bibliography et-al-min="4" et-al-use-first="1" hanging-indent="true" subsequent-author-substitute="" et-al-subsequent-min="4" et-al-subsequent-use-first="1">
    <sort>
      <key macro="author-sort"/>
      <key macro="date-sort-group"/>
      <key macro="date-sort"/>
      <key variable="status"/>
      <key macro="title-bib"/>
      <key variable="part-number"/>
      <key variable="volume"/>
    </sort>
    <layout suffix=".">
      <text macro="bibliography-filtered-author-date"/>
    </layout>
  </bibliography>
</style>
